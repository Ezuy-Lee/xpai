<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RocketMQ生产者消息篇 | x·π</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/xpai/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="x·π学院，为开发者量身制作的技术博客和知识库管理平台,简洁至上,专注于前后端技术学习与总结。">
    <meta name="keywords" content="xpai,x,pai,java,前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/xpai/assets/css/0.styles.79838e76.css" as="style"><link rel="preload" href="/xpai/assets/js/app.463a16ef.js" as="script"><link rel="preload" href="/xpai/assets/js/2.86da3580.js" as="script"><link rel="preload" href="/xpai/assets/js/125.3c3c7cbd.js" as="script"><link rel="prefetch" href="/xpai/assets/js/10.7ee6e0f7.js"><link rel="prefetch" href="/xpai/assets/js/100.ca97340e.js"><link rel="prefetch" href="/xpai/assets/js/101.9fe98dac.js"><link rel="prefetch" href="/xpai/assets/js/102.c21bb621.js"><link rel="prefetch" href="/xpai/assets/js/103.8a98d2bf.js"><link rel="prefetch" href="/xpai/assets/js/104.32ba745b.js"><link rel="prefetch" href="/xpai/assets/js/105.e97d1142.js"><link rel="prefetch" href="/xpai/assets/js/106.0eee2433.js"><link rel="prefetch" href="/xpai/assets/js/107.f18ecd30.js"><link rel="prefetch" href="/xpai/assets/js/108.ed1584c8.js"><link rel="prefetch" href="/xpai/assets/js/109.e3f69cfb.js"><link rel="prefetch" href="/xpai/assets/js/11.d966c9a1.js"><link rel="prefetch" href="/xpai/assets/js/110.c1ae9e32.js"><link rel="prefetch" href="/xpai/assets/js/111.a543b13d.js"><link rel="prefetch" href="/xpai/assets/js/112.559c21bb.js"><link rel="prefetch" href="/xpai/assets/js/113.fc113adc.js"><link rel="prefetch" href="/xpai/assets/js/114.50d5e5a7.js"><link rel="prefetch" href="/xpai/assets/js/115.d86f7ff2.js"><link rel="prefetch" href="/xpai/assets/js/116.0b3801f6.js"><link rel="prefetch" href="/xpai/assets/js/117.a56de7c9.js"><link rel="prefetch" href="/xpai/assets/js/118.1eaab9b4.js"><link rel="prefetch" href="/xpai/assets/js/119.d692ea2a.js"><link rel="prefetch" href="/xpai/assets/js/12.8fe99824.js"><link rel="prefetch" href="/xpai/assets/js/120.1bb73ce4.js"><link rel="prefetch" href="/xpai/assets/js/121.ad4fac1b.js"><link rel="prefetch" href="/xpai/assets/js/122.71447b1b.js"><link rel="prefetch" href="/xpai/assets/js/123.24d55eec.js"><link rel="prefetch" href="/xpai/assets/js/124.30b0b26e.js"><link rel="prefetch" href="/xpai/assets/js/126.4b8fcd6e.js"><link rel="prefetch" href="/xpai/assets/js/127.9aed11fd.js"><link rel="prefetch" href="/xpai/assets/js/128.ccbfe4a0.js"><link rel="prefetch" href="/xpai/assets/js/129.fe318607.js"><link rel="prefetch" href="/xpai/assets/js/13.b8cb0a32.js"><link rel="prefetch" href="/xpai/assets/js/130.d27b4321.js"><link rel="prefetch" href="/xpai/assets/js/131.54d5c00c.js"><link rel="prefetch" href="/xpai/assets/js/132.d8986010.js"><link rel="prefetch" href="/xpai/assets/js/133.f861411c.js"><link rel="prefetch" href="/xpai/assets/js/134.286bfa2b.js"><link rel="prefetch" href="/xpai/assets/js/135.c3db6ed4.js"><link rel="prefetch" href="/xpai/assets/js/136.a5d2ce64.js"><link rel="prefetch" href="/xpai/assets/js/137.550a2277.js"><link rel="prefetch" href="/xpai/assets/js/138.8a99894a.js"><link rel="prefetch" href="/xpai/assets/js/139.ddbbc94f.js"><link rel="prefetch" href="/xpai/assets/js/14.dcefa034.js"><link rel="prefetch" href="/xpai/assets/js/140.3049d182.js"><link rel="prefetch" href="/xpai/assets/js/141.664f5c5d.js"><link rel="prefetch" href="/xpai/assets/js/142.7cee8107.js"><link rel="prefetch" href="/xpai/assets/js/143.f5ec918e.js"><link rel="prefetch" href="/xpai/assets/js/144.22fd0a33.js"><link rel="prefetch" href="/xpai/assets/js/145.c2333593.js"><link rel="prefetch" href="/xpai/assets/js/146.6d807a23.js"><link rel="prefetch" href="/xpai/assets/js/147.29a3cf6f.js"><link rel="prefetch" href="/xpai/assets/js/148.bd6ee5eb.js"><link rel="prefetch" href="/xpai/assets/js/149.7dc1d1ae.js"><link rel="prefetch" href="/xpai/assets/js/15.2a4d0706.js"><link rel="prefetch" href="/xpai/assets/js/150.f40432ae.js"><link rel="prefetch" href="/xpai/assets/js/151.a919b3cc.js"><link rel="prefetch" href="/xpai/assets/js/152.4fa71eca.js"><link rel="prefetch" href="/xpai/assets/js/153.817a4e74.js"><link rel="prefetch" href="/xpai/assets/js/154.2813e444.js"><link rel="prefetch" href="/xpai/assets/js/155.15e81052.js"><link rel="prefetch" href="/xpai/assets/js/156.fa34a481.js"><link rel="prefetch" href="/xpai/assets/js/157.b08b85b0.js"><link rel="prefetch" href="/xpai/assets/js/158.d5371c5a.js"><link rel="prefetch" href="/xpai/assets/js/159.dd75b5f2.js"><link rel="prefetch" href="/xpai/assets/js/16.100620ac.js"><link rel="prefetch" href="/xpai/assets/js/160.127a3238.js"><link rel="prefetch" href="/xpai/assets/js/161.bb763729.js"><link rel="prefetch" href="/xpai/assets/js/162.3f583d73.js"><link rel="prefetch" href="/xpai/assets/js/163.45f9c3c5.js"><link rel="prefetch" href="/xpai/assets/js/164.b517304e.js"><link rel="prefetch" href="/xpai/assets/js/165.78f3e227.js"><link rel="prefetch" href="/xpai/assets/js/166.52ab083a.js"><link rel="prefetch" href="/xpai/assets/js/167.3ff08448.js"><link rel="prefetch" href="/xpai/assets/js/168.b76ede0e.js"><link rel="prefetch" href="/xpai/assets/js/169.e7045a07.js"><link rel="prefetch" href="/xpai/assets/js/17.edd38bb7.js"><link rel="prefetch" href="/xpai/assets/js/170.28967c99.js"><link rel="prefetch" href="/xpai/assets/js/171.c3b3d33f.js"><link rel="prefetch" href="/xpai/assets/js/172.8efd4d5f.js"><link rel="prefetch" href="/xpai/assets/js/173.e8929a24.js"><link rel="prefetch" href="/xpai/assets/js/174.69fd1c95.js"><link rel="prefetch" href="/xpai/assets/js/175.71b34cd8.js"><link rel="prefetch" href="/xpai/assets/js/176.d12259c4.js"><link rel="prefetch" href="/xpai/assets/js/177.43021615.js"><link rel="prefetch" href="/xpai/assets/js/178.2110b762.js"><link rel="prefetch" href="/xpai/assets/js/179.3ee7894a.js"><link rel="prefetch" href="/xpai/assets/js/18.60ad374d.js"><link rel="prefetch" href="/xpai/assets/js/180.0203c68e.js"><link rel="prefetch" href="/xpai/assets/js/181.9de24c6a.js"><link rel="prefetch" href="/xpai/assets/js/182.8bd7b605.js"><link rel="prefetch" href="/xpai/assets/js/183.7b9777ab.js"><link rel="prefetch" href="/xpai/assets/js/184.06c8f682.js"><link rel="prefetch" href="/xpai/assets/js/185.533fd089.js"><link rel="prefetch" href="/xpai/assets/js/186.da02af0d.js"><link rel="prefetch" href="/xpai/assets/js/187.0ad9bbf4.js"><link rel="prefetch" href="/xpai/assets/js/188.680a1397.js"><link rel="prefetch" href="/xpai/assets/js/189.2b70c6ba.js"><link rel="prefetch" href="/xpai/assets/js/19.37ca1303.js"><link rel="prefetch" href="/xpai/assets/js/190.72b2201b.js"><link rel="prefetch" href="/xpai/assets/js/191.452f27d6.js"><link rel="prefetch" href="/xpai/assets/js/192.77a42070.js"><link rel="prefetch" href="/xpai/assets/js/193.5df63776.js"><link rel="prefetch" href="/xpai/assets/js/194.60512671.js"><link rel="prefetch" href="/xpai/assets/js/195.dfee0b35.js"><link rel="prefetch" href="/xpai/assets/js/196.b089bf1c.js"><link rel="prefetch" href="/xpai/assets/js/197.3231ab2f.js"><link rel="prefetch" href="/xpai/assets/js/198.d7cc85e4.js"><link rel="prefetch" href="/xpai/assets/js/199.49b9190b.js"><link rel="prefetch" href="/xpai/assets/js/20.49b1af17.js"><link rel="prefetch" href="/xpai/assets/js/200.312f11fb.js"><link rel="prefetch" href="/xpai/assets/js/201.22e1bc76.js"><link rel="prefetch" href="/xpai/assets/js/202.df0ea0e5.js"><link rel="prefetch" href="/xpai/assets/js/203.8e21b7a0.js"><link rel="prefetch" href="/xpai/assets/js/204.2ae4a97a.js"><link rel="prefetch" href="/xpai/assets/js/205.5cbe7da4.js"><link rel="prefetch" href="/xpai/assets/js/206.d5e490e9.js"><link rel="prefetch" href="/xpai/assets/js/207.f34c5ce1.js"><link rel="prefetch" href="/xpai/assets/js/208.5fdf7bf3.js"><link rel="prefetch" href="/xpai/assets/js/209.b028c8d0.js"><link rel="prefetch" href="/xpai/assets/js/21.db66bdd8.js"><link rel="prefetch" href="/xpai/assets/js/210.75dfc456.js"><link rel="prefetch" href="/xpai/assets/js/211.76bdfd3a.js"><link rel="prefetch" href="/xpai/assets/js/212.6f693c8e.js"><link rel="prefetch" href="/xpai/assets/js/213.78008b66.js"><link rel="prefetch" href="/xpai/assets/js/214.0289290f.js"><link rel="prefetch" href="/xpai/assets/js/215.fea6ffaf.js"><link rel="prefetch" href="/xpai/assets/js/216.232c62bc.js"><link rel="prefetch" href="/xpai/assets/js/217.7eb2090b.js"><link rel="prefetch" href="/xpai/assets/js/218.40542780.js"><link rel="prefetch" href="/xpai/assets/js/219.0a908ea4.js"><link rel="prefetch" href="/xpai/assets/js/22.ad9dc733.js"><link rel="prefetch" href="/xpai/assets/js/220.b0417a42.js"><link rel="prefetch" href="/xpai/assets/js/221.24ec4a64.js"><link rel="prefetch" href="/xpai/assets/js/222.5cd49c8f.js"><link rel="prefetch" href="/xpai/assets/js/223.c502ecd6.js"><link rel="prefetch" href="/xpai/assets/js/224.1de749c7.js"><link rel="prefetch" href="/xpai/assets/js/225.f3d0e310.js"><link rel="prefetch" href="/xpai/assets/js/226.65550f73.js"><link rel="prefetch" href="/xpai/assets/js/227.dda125e0.js"><link rel="prefetch" href="/xpai/assets/js/228.5a206fc6.js"><link rel="prefetch" href="/xpai/assets/js/229.d4421e9e.js"><link rel="prefetch" href="/xpai/assets/js/23.3428586b.js"><link rel="prefetch" href="/xpai/assets/js/230.c74da9c1.js"><link rel="prefetch" href="/xpai/assets/js/231.9a0a1cf7.js"><link rel="prefetch" href="/xpai/assets/js/232.e63a0e1f.js"><link rel="prefetch" href="/xpai/assets/js/233.df08bcaa.js"><link rel="prefetch" href="/xpai/assets/js/234.96ed772e.js"><link rel="prefetch" href="/xpai/assets/js/235.3ec201f2.js"><link rel="prefetch" href="/xpai/assets/js/236.57013513.js"><link rel="prefetch" href="/xpai/assets/js/237.914aea19.js"><link rel="prefetch" href="/xpai/assets/js/238.a202c8a7.js"><link rel="prefetch" href="/xpai/assets/js/239.9f593f79.js"><link rel="prefetch" href="/xpai/assets/js/24.1ec99cff.js"><link rel="prefetch" href="/xpai/assets/js/240.8e44d3ca.js"><link rel="prefetch" href="/xpai/assets/js/241.4ba1e308.js"><link rel="prefetch" href="/xpai/assets/js/242.8529cc75.js"><link rel="prefetch" href="/xpai/assets/js/243.5004c9b3.js"><link rel="prefetch" href="/xpai/assets/js/244.a2119850.js"><link rel="prefetch" href="/xpai/assets/js/245.8c643ead.js"><link rel="prefetch" href="/xpai/assets/js/246.c0fba80d.js"><link rel="prefetch" href="/xpai/assets/js/247.000e839a.js"><link rel="prefetch" href="/xpai/assets/js/248.2d135521.js"><link rel="prefetch" href="/xpai/assets/js/249.3422287d.js"><link rel="prefetch" href="/xpai/assets/js/25.117dc1ab.js"><link rel="prefetch" href="/xpai/assets/js/250.f329da47.js"><link rel="prefetch" href="/xpai/assets/js/251.51e2aad1.js"><link rel="prefetch" href="/xpai/assets/js/252.9cb3d88b.js"><link rel="prefetch" href="/xpai/assets/js/253.9da51af7.js"><link rel="prefetch" href="/xpai/assets/js/254.3165fc09.js"><link rel="prefetch" href="/xpai/assets/js/255.cb4062a4.js"><link rel="prefetch" href="/xpai/assets/js/256.d79d6f90.js"><link rel="prefetch" href="/xpai/assets/js/257.12fb4db7.js"><link rel="prefetch" href="/xpai/assets/js/258.e1515c48.js"><link rel="prefetch" href="/xpai/assets/js/259.0a09c73f.js"><link rel="prefetch" href="/xpai/assets/js/26.7b6f1292.js"><link rel="prefetch" href="/xpai/assets/js/260.54480a98.js"><link rel="prefetch" href="/xpai/assets/js/261.0545fd8e.js"><link rel="prefetch" href="/xpai/assets/js/262.ff374c70.js"><link rel="prefetch" href="/xpai/assets/js/263.ee5f0590.js"><link rel="prefetch" href="/xpai/assets/js/264.483d0ef8.js"><link rel="prefetch" href="/xpai/assets/js/265.4da521dc.js"><link rel="prefetch" href="/xpai/assets/js/266.aaeb58f1.js"><link rel="prefetch" href="/xpai/assets/js/267.aca23f83.js"><link rel="prefetch" href="/xpai/assets/js/268.f3b2d4a1.js"><link rel="prefetch" href="/xpai/assets/js/269.b4409f77.js"><link rel="prefetch" href="/xpai/assets/js/27.4abb37d7.js"><link rel="prefetch" href="/xpai/assets/js/270.d76a14f2.js"><link rel="prefetch" href="/xpai/assets/js/271.8242cd05.js"><link rel="prefetch" href="/xpai/assets/js/272.799398e1.js"><link rel="prefetch" href="/xpai/assets/js/273.90aee646.js"><link rel="prefetch" href="/xpai/assets/js/274.f8b4ca70.js"><link rel="prefetch" href="/xpai/assets/js/275.c2ee0bd0.js"><link rel="prefetch" href="/xpai/assets/js/276.742fe95c.js"><link rel="prefetch" href="/xpai/assets/js/277.d6040ffc.js"><link rel="prefetch" href="/xpai/assets/js/278.ab5d4432.js"><link rel="prefetch" href="/xpai/assets/js/279.188e5df9.js"><link rel="prefetch" href="/xpai/assets/js/28.1c1fe9b2.js"><link rel="prefetch" href="/xpai/assets/js/280.e9b9f629.js"><link rel="prefetch" href="/xpai/assets/js/281.a83c892f.js"><link rel="prefetch" href="/xpai/assets/js/282.2fab9b7f.js"><link rel="prefetch" href="/xpai/assets/js/283.1971678f.js"><link rel="prefetch" href="/xpai/assets/js/284.9e42daa0.js"><link rel="prefetch" href="/xpai/assets/js/285.cd747472.js"><link rel="prefetch" href="/xpai/assets/js/286.8e468c09.js"><link rel="prefetch" href="/xpai/assets/js/287.22c9485f.js"><link rel="prefetch" href="/xpai/assets/js/288.34101bfd.js"><link rel="prefetch" href="/xpai/assets/js/289.d12821df.js"><link rel="prefetch" href="/xpai/assets/js/29.ab9e2995.js"><link rel="prefetch" href="/xpai/assets/js/290.73ca9fde.js"><link rel="prefetch" href="/xpai/assets/js/291.0e9a3b5a.js"><link rel="prefetch" href="/xpai/assets/js/292.ddd9db4e.js"><link rel="prefetch" href="/xpai/assets/js/293.5151011b.js"><link rel="prefetch" href="/xpai/assets/js/294.787e0f5a.js"><link rel="prefetch" href="/xpai/assets/js/295.6be83c2e.js"><link rel="prefetch" href="/xpai/assets/js/296.179e3bae.js"><link rel="prefetch" href="/xpai/assets/js/297.980f652e.js"><link rel="prefetch" href="/xpai/assets/js/298.827ba7c3.js"><link rel="prefetch" href="/xpai/assets/js/299.c7715539.js"><link rel="prefetch" href="/xpai/assets/js/3.cab0040e.js"><link rel="prefetch" href="/xpai/assets/js/30.bb98e080.js"><link rel="prefetch" href="/xpai/assets/js/300.3a5e31e3.js"><link rel="prefetch" href="/xpai/assets/js/301.652d80ac.js"><link rel="prefetch" href="/xpai/assets/js/302.388b4851.js"><link rel="prefetch" href="/xpai/assets/js/303.5f95420a.js"><link rel="prefetch" href="/xpai/assets/js/304.9543ba37.js"><link rel="prefetch" href="/xpai/assets/js/305.0a4d2b3d.js"><link rel="prefetch" href="/xpai/assets/js/306.16988031.js"><link rel="prefetch" href="/xpai/assets/js/307.4d7a759d.js"><link rel="prefetch" href="/xpai/assets/js/308.27e25b6a.js"><link rel="prefetch" href="/xpai/assets/js/309.8471a949.js"><link rel="prefetch" href="/xpai/assets/js/31.68e0e25d.js"><link rel="prefetch" href="/xpai/assets/js/310.e9b36953.js"><link rel="prefetch" href="/xpai/assets/js/311.5463ec0c.js"><link rel="prefetch" href="/xpai/assets/js/312.334ad312.js"><link rel="prefetch" href="/xpai/assets/js/313.7ce59ee7.js"><link rel="prefetch" href="/xpai/assets/js/314.24652da0.js"><link rel="prefetch" href="/xpai/assets/js/315.2cfa659a.js"><link rel="prefetch" href="/xpai/assets/js/316.6e19c913.js"><link rel="prefetch" href="/xpai/assets/js/317.4f08fa8e.js"><link rel="prefetch" href="/xpai/assets/js/318.c184fba2.js"><link rel="prefetch" href="/xpai/assets/js/319.d94e39eb.js"><link rel="prefetch" href="/xpai/assets/js/32.ef68da65.js"><link rel="prefetch" href="/xpai/assets/js/320.49cf32bc.js"><link rel="prefetch" href="/xpai/assets/js/321.c285126f.js"><link rel="prefetch" href="/xpai/assets/js/322.588c7bd1.js"><link rel="prefetch" href="/xpai/assets/js/323.9116b884.js"><link rel="prefetch" href="/xpai/assets/js/324.2ea5c8c8.js"><link rel="prefetch" href="/xpai/assets/js/325.5010ca7b.js"><link rel="prefetch" href="/xpai/assets/js/326.eb06b2a3.js"><link rel="prefetch" href="/xpai/assets/js/327.adc38e90.js"><link rel="prefetch" href="/xpai/assets/js/328.db03c4e6.js"><link rel="prefetch" href="/xpai/assets/js/329.acb93377.js"><link rel="prefetch" href="/xpai/assets/js/33.5d570484.js"><link rel="prefetch" href="/xpai/assets/js/330.646a6c29.js"><link rel="prefetch" href="/xpai/assets/js/331.b8782f0b.js"><link rel="prefetch" href="/xpai/assets/js/332.f0db34b4.js"><link rel="prefetch" href="/xpai/assets/js/333.fa51fd3e.js"><link rel="prefetch" href="/xpai/assets/js/334.60fc8f8d.js"><link rel="prefetch" href="/xpai/assets/js/335.e7cedbc9.js"><link rel="prefetch" href="/xpai/assets/js/336.23ebc07f.js"><link rel="prefetch" href="/xpai/assets/js/337.359d68de.js"><link rel="prefetch" href="/xpai/assets/js/338.5b6b6766.js"><link rel="prefetch" href="/xpai/assets/js/339.fc66f3d7.js"><link rel="prefetch" href="/xpai/assets/js/34.a5238ebc.js"><link rel="prefetch" href="/xpai/assets/js/340.7cfc7432.js"><link rel="prefetch" href="/xpai/assets/js/341.4304cbba.js"><link rel="prefetch" href="/xpai/assets/js/342.ffa46baf.js"><link rel="prefetch" href="/xpai/assets/js/343.ce0a15f1.js"><link rel="prefetch" href="/xpai/assets/js/344.3324ad6c.js"><link rel="prefetch" href="/xpai/assets/js/345.141f5109.js"><link rel="prefetch" href="/xpai/assets/js/346.607ca4f2.js"><link rel="prefetch" href="/xpai/assets/js/347.7caeef96.js"><link rel="prefetch" href="/xpai/assets/js/348.f0775e41.js"><link rel="prefetch" href="/xpai/assets/js/349.a001db3d.js"><link rel="prefetch" href="/xpai/assets/js/35.59de4997.js"><link rel="prefetch" href="/xpai/assets/js/350.77cc6653.js"><link rel="prefetch" href="/xpai/assets/js/351.34fe0651.js"><link rel="prefetch" href="/xpai/assets/js/36.ff92d3c8.js"><link rel="prefetch" href="/xpai/assets/js/37.4351ce5f.js"><link rel="prefetch" href="/xpai/assets/js/38.9eca4ff4.js"><link rel="prefetch" href="/xpai/assets/js/39.265a5d9a.js"><link rel="prefetch" href="/xpai/assets/js/4.10fa6d3b.js"><link rel="prefetch" href="/xpai/assets/js/40.3635d39d.js"><link rel="prefetch" href="/xpai/assets/js/41.4f91b146.js"><link rel="prefetch" href="/xpai/assets/js/42.2b713cb9.js"><link rel="prefetch" href="/xpai/assets/js/43.2c34c804.js"><link rel="prefetch" href="/xpai/assets/js/44.8f191f8f.js"><link rel="prefetch" href="/xpai/assets/js/45.4f628df8.js"><link rel="prefetch" href="/xpai/assets/js/46.1c757b3d.js"><link rel="prefetch" href="/xpai/assets/js/47.2961b598.js"><link rel="prefetch" href="/xpai/assets/js/48.54ffe40c.js"><link rel="prefetch" href="/xpai/assets/js/49.e0e4765d.js"><link rel="prefetch" href="/xpai/assets/js/5.ab0b3475.js"><link rel="prefetch" href="/xpai/assets/js/50.2de67866.js"><link rel="prefetch" href="/xpai/assets/js/51.e1ce0592.js"><link rel="prefetch" href="/xpai/assets/js/52.21f1bb15.js"><link rel="prefetch" href="/xpai/assets/js/53.557503f1.js"><link rel="prefetch" href="/xpai/assets/js/54.98566dfe.js"><link rel="prefetch" href="/xpai/assets/js/55.960d350f.js"><link rel="prefetch" href="/xpai/assets/js/56.e59740f6.js"><link rel="prefetch" href="/xpai/assets/js/57.f5af4efc.js"><link rel="prefetch" href="/xpai/assets/js/58.3db80afc.js"><link rel="prefetch" href="/xpai/assets/js/59.fb2fac89.js"><link rel="prefetch" href="/xpai/assets/js/6.41101de3.js"><link rel="prefetch" href="/xpai/assets/js/60.ef88b46d.js"><link rel="prefetch" href="/xpai/assets/js/61.331d64e6.js"><link rel="prefetch" href="/xpai/assets/js/62.c5cbce0e.js"><link rel="prefetch" href="/xpai/assets/js/63.6dbec697.js"><link rel="prefetch" href="/xpai/assets/js/64.46384523.js"><link rel="prefetch" href="/xpai/assets/js/65.5ff2ae14.js"><link rel="prefetch" href="/xpai/assets/js/66.97f80a65.js"><link rel="prefetch" href="/xpai/assets/js/67.bf1f054e.js"><link rel="prefetch" href="/xpai/assets/js/68.8e84d8ae.js"><link rel="prefetch" href="/xpai/assets/js/69.a3026fe1.js"><link rel="prefetch" href="/xpai/assets/js/7.7b35634d.js"><link rel="prefetch" href="/xpai/assets/js/70.40196887.js"><link rel="prefetch" href="/xpai/assets/js/71.0058aceb.js"><link rel="prefetch" href="/xpai/assets/js/72.7b3cc131.js"><link rel="prefetch" href="/xpai/assets/js/73.cd93e827.js"><link rel="prefetch" href="/xpai/assets/js/74.1600d2c6.js"><link rel="prefetch" href="/xpai/assets/js/75.4662b401.js"><link rel="prefetch" href="/xpai/assets/js/76.0163c641.js"><link rel="prefetch" href="/xpai/assets/js/77.d30ad138.js"><link rel="prefetch" href="/xpai/assets/js/78.70e29d3d.js"><link rel="prefetch" href="/xpai/assets/js/79.d7dd87f6.js"><link rel="prefetch" href="/xpai/assets/js/8.5f0e5018.js"><link rel="prefetch" href="/xpai/assets/js/80.e15cdd35.js"><link rel="prefetch" href="/xpai/assets/js/81.d7722150.js"><link rel="prefetch" href="/xpai/assets/js/82.8db1dc2d.js"><link rel="prefetch" href="/xpai/assets/js/83.8cdd8e3d.js"><link rel="prefetch" href="/xpai/assets/js/84.be3bbb89.js"><link rel="prefetch" href="/xpai/assets/js/85.bd4fb17d.js"><link rel="prefetch" href="/xpai/assets/js/86.8132e8a6.js"><link rel="prefetch" href="/xpai/assets/js/87.eef138b7.js"><link rel="prefetch" href="/xpai/assets/js/88.6a955e9d.js"><link rel="prefetch" href="/xpai/assets/js/89.35fe37ae.js"><link rel="prefetch" href="/xpai/assets/js/9.8b0545db.js"><link rel="prefetch" href="/xpai/assets/js/90.c663c19c.js"><link rel="prefetch" href="/xpai/assets/js/91.1b5a38b0.js"><link rel="prefetch" href="/xpai/assets/js/92.db3ae417.js"><link rel="prefetch" href="/xpai/assets/js/93.d5e4a4c0.js"><link rel="prefetch" href="/xpai/assets/js/94.295d99d0.js"><link rel="prefetch" href="/xpai/assets/js/95.49a70622.js"><link rel="prefetch" href="/xpai/assets/js/96.b0673c60.js"><link rel="prefetch" href="/xpai/assets/js/97.529dda13.js"><link rel="prefetch" href="/xpai/assets/js/98.b7c5d802.js"><link rel="prefetch" href="/xpai/assets/js/99.f0302d8a.js">
    <link rel="stylesheet" href="/xpai/assets/css/0.styles.79838e76.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xpai/" class="home-link router-link-active"><img src="/xpai/img/logo.png" alt="x·π" class="logo"> <span class="site-name can-hide">x·π</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xpai/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/xpai/back_end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/6d04efbdfa185c88916a6edec2b5bec9/" class="nav-link">Java基础篇</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/6b89cf0a450c5012bb4bdc12eea6bf40/" class="nav-link">Java框架篇</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/5f77f3ea97b75a5c9ffb0c5f1d7e3a72/" class="nav-link">CVS版本控制</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/70b389/" class="nav-link">数据库和缓存</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/8a0e5f/" class="nav-link">设计模式和架构</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/78189d/" class="nav-link">容器化和中间件</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/6d75fa6409b55e52a52a870a48f217fe/" class="nav-link">Linux运维和测试</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/1d539d/" class="nav-link">大数据和云计算</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/41fde4/" class="nav-link">工具和环境</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/xpai/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/of4wa5/" class="nav-link">前端基础</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/9c53a1/" class="nav-link">前端框架</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/291a73/" class="nav-link">可视化</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/bbf7bd/" class="nav-link">UI设计和产品</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/0c01fa/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><a href="/xpai/work/" class="link-title">工作</a> <span class="title" style="display:none;">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/236765/" class="nav-link">个人</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/be82e4/" class="nav-link">公司</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><a href="/xpai/tool/" class="link-title">工具箱</a> <span class="title" style="display:none;">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/d9f31f/" class="nav-link">在线工具</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/a9fdaa/" class="nav-link">后端工具</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/2910b4/" class="nav-link">前端工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="导航" class="dropdown-title"><a href="/xpai/navigation/" class="link-title">导航</a> <span class="title" style="display:none;">导航</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/a0fb53/" class="nav-link">后端学习</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/c0ac49/" class="nav-link">前端学习</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/2e2565/" class="nav-link">软件资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/xpai/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/284202/" class="nav-link">学习阅读</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/96d03e/" class="nav-link">面试经验</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/34a617/" class="nav-link">心情杂谈</a></li><li class="dropdown-item"><!----> <a href="/xpai/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/xpai/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/xpai/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/xpai/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/xpai/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/blogger-avatar.png"> <div class="blogger-info"><h3>雨小泽</h3> <span>一个北漂95后！正在潜心研究前端和Java后端技术，一边学习一边积累经验</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/xpai/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/xpai/back_end/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/6d04efbdfa185c88916a6edec2b5bec9/" class="nav-link">Java基础篇</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/6b89cf0a450c5012bb4bdc12eea6bf40/" class="nav-link">Java框架篇</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/5f77f3ea97b75a5c9ffb0c5f1d7e3a72/" class="nav-link">CVS版本控制</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/70b389/" class="nav-link">数据库和缓存</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/8a0e5f/" class="nav-link">设计模式和架构</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/78189d/" class="nav-link">容器化和中间件</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/6d75fa6409b55e52a52a870a48f217fe/" class="nav-link">Linux运维和测试</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/1d539d/" class="nav-link">大数据和云计算</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/41fde4/" class="nav-link">工具和环境</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/xpai/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/of4wa5/" class="nav-link">前端基础</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/9c53a1/" class="nav-link">前端框架</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/291a73/" class="nav-link">可视化</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/bbf7bd/" class="nav-link">UI设计和产品</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/0c01fa/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><a href="/xpai/work/" class="link-title">工作</a> <span class="title" style="display:none;">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/236765/" class="nav-link">个人</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/be82e4/" class="nav-link">公司</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><a href="/xpai/tool/" class="link-title">工具箱</a> <span class="title" style="display:none;">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/d9f31f/" class="nav-link">在线工具</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/a9fdaa/" class="nav-link">后端工具</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/2910b4/" class="nav-link">前端工具</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="导航" class="dropdown-title"><a href="/xpai/navigation/" class="link-title">导航</a> <span class="title" style="display:none;">导航</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/a0fb53/" class="nav-link">后端学习</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/c0ac49/" class="nav-link">前端学习</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/2e2565/" class="nav-link">软件资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/xpai/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/pages/284202/" class="nav-link">学习阅读</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/96d03e/" class="nav-link">面试经验</a></li><li class="dropdown-item"><!----> <a href="/xpai/pages/34a617/" class="nav-link">心情杂谈</a></li><li class="dropdown-item"><!----> <a href="/xpai/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/xpai/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xpai/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/xpai/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/xpai/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/xpai/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java框架篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CVS版本控制</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库和缓存</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式和架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>容器化和中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xpai/pages/78189d/" class="sidebar-link">《容器化和中间件》</a></li><li><a href="/xpai/pages/758b05/" class="sidebar-link">Zookeeper入门</a></li><li><a href="/xpai/pages/f8acd3/" class="sidebar-link">Apollo配置中心详解</a></li><li><a href="/xpai/pages/0aa9a6/" class="sidebar-link">日志集中以及链路跟踪分析平台ELK</a></li><li><a href="/xpai/pages/dd3963/" class="sidebar-link">Jenkins+Maven+Git+Tomcat持续集成实战</a></li><li><a href="/xpai/pages/f582e6/" class="sidebar-link">Nginx基本入门</a></li><li><a href="/xpai/pages/08a5a6/" class="sidebar-link">最全Nginx配置文件详解</a></li><li><a href="/xpai/pages/935806/" class="sidebar-link">Nginx+Tomcat+MemCached 集群配置</a></li><li><a href="/xpai/pages/c3d6ba/" class="sidebar-link">Nginx+Tomcat集群负载均衡实现session复制</a></li><li><a href="/xpai/pages/13e02a/" class="sidebar-link">用Redis存储Tomcat集群的Session</a></li><li><a href="/xpai/pages/e8fd25/" class="sidebar-link">使用keepalived实现双机热备</a></li><li><a href="/xpai/pages/027cf7/" class="sidebar-link">ELasticJob分布式任务调度</a></li><li><a href="/xpai/pages/370ccb/" class="sidebar-link">分布式文件系统FastDFS实战</a></li><li><a href="/xpai/pages/f86627/" class="sidebar-link">Mycat入门</a></li><li><a href="/xpai/pages/abace2/" class="sidebar-link">Mycat读写分离</a></li><li><a href="/xpai/pages/3e2ce5/" class="sidebar-link">Kafka快速开始</a></li><li><a href="/xpai/pages/a6a7f6/" class="sidebar-link">Nginx+Tomcat关于Session的管理</a></li><li><a href="/xpai/pages/b17b7a/" class="sidebar-link">Tomcat Session管理分析</a></li><li><a href="/xpai/pages/c276b5/" class="sidebar-link">Spring-Session基于Redis管理Session</a></li><li><a href="/xpai/pages/8931d7/" class="sidebar-link">Zipkin快速开始</a></li><li><a href="/xpai/pages/e15437/" class="sidebar-link">基于ELK整合测试</a></li><li><a href="/xpai/pages/93f273/" class="sidebar-link">RocketMQ入门篇</a></li><li><a href="/xpai/pages/37e0fd/" class="sidebar-link">RocketMQ生产者流程篇</a></li><li><a href="/xpai/pages/09b0f3/" aria-current="page" class="active sidebar-link">RocketMQ生产者消息篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#通信模式" class="sidebar-link">通信模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_1-同步方式" class="sidebar-link">1.同步方式</a></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_2-异步方式" class="sidebar-link">2.异步方式</a></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_3-单向方式" class="sidebar-link">3.单向方式</a></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_4-发送状态" class="sidebar-link">4.发送状态</a></li></ul></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#消息类型" class="sidebar-link">消息类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_1-延迟消息" class="sidebar-link">1.延迟消息</a></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_2-顺序消息" class="sidebar-link">2.顺序消息</a></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#_3-事务消息" class="sidebar-link">3.事务消息</a></li></ul></li><li class="sidebar-sub-header"><a href="/xpai/pages/09b0f3/#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/xpai/pages/5a3e14/" class="sidebar-link">从RocketMQ看长轮询</a></li><li><a href="/xpai/pages/960ace/" class="sidebar-link">Spring整合Quartz分布式调度</a></li><li><a href="/xpai/pages/3e654f/" class="sidebar-link">Quartz数据库表分析</a></li><li><a href="/xpai/pages/25fdd2/" class="sidebar-link">Quartz调度源码分析</a></li><li><a href="/xpai/pages/156b49/" class="sidebar-link">基于Netty+Zookeeper+Quartz调度分析</a></li><li><a href="/xpai/pages/a3cc9a/" class="sidebar-link">细数那些使用过的定时器</a></li><li><a href="/xpai/pages/60f509/" class="sidebar-link">JMS消息确认和事务</a></li><li><a href="/xpai/pages/b0efb9/" class="sidebar-link">JMS实现参数的集中式管理</a></li><li><a href="/xpai/pages/651eec/" class="sidebar-link">Redis实现参数的集中式管理</a></li><li><a href="/xpai/pages/6401c6/" class="sidebar-link">Zookeeper实现参数的集中式管理</a></li><li><a href="/xpai/pages/ead2f9/" class="sidebar-link">Dubbo分析之Serialize层</a></li><li><a href="/xpai/pages/3a9b1d/" class="sidebar-link">Dubbo分析之Transport层</a></li><li><a href="/xpai/pages/549b55/" class="sidebar-link">Dubbo分析之Exchange层</a></li><li><a href="/xpai/pages/7b1cc3/" class="sidebar-link">Dubbo分析之Cluster层</a></li><li><a href="/xpai/pages/f3c30b/" class="sidebar-link">Dubbo分析之Protocol层</a></li><li><a href="/xpai/pages/4164c3/" class="sidebar-link">Dubbo分析之Registry层</a></li><li><a href="/xpai/pages/c91d7c/" class="sidebar-link">Dubbo分析之心跳设计</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux运维和测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据和云计算</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具和环境</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/xpai/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/xpai/back_end" title="后端-目录页" data-v-1cd794fe>后端</a></li> <li data-v-1cd794fe><a href="/xpai/back_end/#容器化和中间件" title="后端#容器化和中间件" data-v-1cd794fe>容器化和中间件</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/Ezuy-Lee" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Rainze-Lee</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-06-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          RocketMQ生产者消息篇
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>上文RocketMQ生产者流程篇中详细介绍了生产者发送消息的流程，本文将重点介绍发送消息的通信模式以及各种不同的消息类型。</p> <h2 id="通信模式"><a href="#通信模式" class="header-anchor">#</a> 通信模式</h2> <p>RocketMQ提供了三种通讯模式，分别是：同步，异步和单向；可以查看内部类CommunicationMode：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public enum CommunicationMode {
    SYNC,
    ASYNC,
    ONEWAY,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>下面分别看一下三种通讯模式如何使用</p> <h3 id="_1-同步方式"><a href="#_1-同步方式" class="header-anchor">#</a> 1.同步方式</h3> <p>看一个简单的发送同步消息的实例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SyncProducer {

    public static void main(String[] args) throws Exception {

        System.setProperty(&quot;rocketmq.namesrv.domain&quot;, &quot;localhost&quot;);
        // 构造Producer
        DefaultMQProducer producer = new DefaultMQProducer(&quot;ProducerGroupName2&quot;);
        // producer.setNamesrvAddr(&quot;192.168.237.128:9876&quot;);
        // 初始化Producer，整个应用生命周期内，只需要初始化1次
        producer.start();

        for (int i = 0; i &lt; 1; i++) {
            Message msg = new Message(&quot;TopicTest6&quot;, &quot;TagA&quot;,
                    (&quot;Hello RocketMQ&quot; + i).getBytes(RemotingHelper.DEFAULT_CHARSET));
            SendResult sendResult = producer.send(msg);
            System.out.println(sendResult);
        }
        producer.shutdown();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>最简单的直接指定一个message参数默认使用的就是同步方式发送消息，可以看到在发送完消息之后，会立马返回了发送结果SendResult:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SendResult [sendStatus=SEND_OK, msgId=0A0D5307324873D16E9365360AC60000, offsetMsgId=0A0D530700002A9F0000000000001200, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=0]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-异步方式"><a href="#_2-异步方式" class="header-anchor">#</a> 2.异步方式</h3> <p>看一个简单的发送异步消息的实例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class AsyncProducer {

    public static void main(String[] args)
            throws MQClientException, RemotingException, InterruptedException, UnsupportedEncodingException {
        DefaultMQProducer producer = new DefaultMQProducer(&quot;ProducerGroupName2&quot;);
        producer.setRetryTimesWhenSendAsyncFailed(3);
        producer.setNamesrvAddr(&quot;192.168.237.128:9876&quot;);
        producer.start();
        for (int i = 0; i &lt; 1; i++) {
            Message msg = new Message(&quot;TopicTest6&quot;, &quot;TagA&quot;,
                    (&quot;Hello RocketMQ&quot; + i).getBytes(RemotingHelper.DEFAULT_CHARSET));
            producer.send(msg, new SendCallback() {
                @Override
                public void onSuccess(SendResult sendResult) {
                    System.out.println(sendResult);
                }

                @Override
                public void onException(Throwable e) {
                    e.printStackTrace();
                }
            });
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>可以看到在发送消息时指定了SendCallback回调类，send发送方法返回值为void，发送成功之后会回调SendCallback的onSuccess方法，异常调用onException方法；发送成功日志如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SendResult [sendStatus=SEND_OK, msgId=0A0D5307261473D16E936536591E0000, offsetMsgId=0A0D530700002A9F00000000000012B2, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=1]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-单向方式"><a href="#_3-单向方式" class="header-anchor">#</a> 3.单向方式</h3> <p>看一个简单的发送单向消息的实例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class OneWayProducer {

    public static void main(String[] args) throws Exception {

        DefaultMQProducer producer = new DefaultMQProducer(&quot;ProducerGroupName2&quot;);
        producer.setNamesrvAddr(&quot;192.168.237.128:9876&quot;);
        producer.start();
        for (int i = 0; i &lt; 1; i++) {
            Message msg = new Message(&quot;TopicTest6&quot;, &quot;TagA&quot;,
                    (&quot;Hello RocketMQ&quot; + i).getBytes(RemotingHelper.DEFAULT_CHARSET));
            producer.sendOneway(msg);
        }
        producer.shutdown();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>单向发送消息发送之后没有响应，但是在消费端可以收到消息，如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ConsumeMessageThread_6Receive New Messages :[MessageExt [queueId=2, storeSize=178, queueOffset=0, sysFlag=0, bornTimestamp=1550648529526, bornHost=/10.13.83.7:54213, storeTimestamp=1550648529530, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000001416, commitLogOffset=5142, bodyCRC=705268097, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=1, CONSUME_START_TIME=1550648529533, UNIQ_KEY=0A0D530747DC73D16E93653766750000, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 48], transactionId='null'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4-发送状态"><a href="#_4-发送状态" class="header-anchor">#</a> 4.发送状态</h3> <p>以上同步和异步实例显示的发送状态都是SEND_OK，除了此状态还有其他三个状态：FLUSH_DISK_TIMEOUT，FLUSH_SLAVE_TIMEOUT和SLAVE_NOT_AVAILABLE；具体可以查看内部类SendStatus：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public enum SendStatus {
    SEND_OK,
    FLUSH_DISK_TIMEOUT,
    FLUSH_SLAVE_TIMEOUT,
    SLAVE_NOT_AVAILABLE,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>FLUSH_DISK_TIMEOUT：刷盘超时，Broker设置的刷盘策略为SYNC_FLUSH才可能出现此错误；<br>
FLUSH_SLAVE_TIMEOUT：主从同步超时，Broker设置了slave，并且指定同步策略为SYNC_Master；<br>
SLAVE_NOT_AVAILABLE：找不到salve，同样是Broke指定同步策略为SYNC_Master；<br>
SEND_OK：表示发送成功，以上情况都没有出现。<br>
注：必要时需要对各种异常场景进行处理，保证高质量的生产者。</p> <h2 id="消息类型"><a href="#消息类型" class="header-anchor">#</a> 消息类型</h2> <p>在RocketMQ的生产者端可以发送多种类型的消息包括：延迟消息，顺序消息以及事务消息，下面分别进行实例分析；</p> <h3 id="_1-延迟消息"><a href="#_1-延迟消息" class="header-anchor">#</a> 1.延迟消息</h3> <p>RocketMQ支持发送延迟消息，Broker收到消息后会延迟一段时间在处理，具体使用看如下代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Message msg = new Message(&quot;TopicTest6&quot;, &quot;TagA&quot;,
                    (&quot;Hello RocketMQ&quot; + i).getBytes(RemotingHelper.DEFAULT_CHARSET));
msg.setDelayTimeLevel(3);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以直接设置延迟时间等级，具体有哪些等级，以及每个等级对应的时间可以查看类MessageStoreConfig</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>private String messageDelayLevel = &quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>类中的messageDelayLevel 变量包含了所有可以延迟的时间，使用空格分离，所以这里等级为3，其实对应的延迟时间就是10秒；分别观察生产者和消费者的日志如下：<br>
生产者发送消息日志如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Wed Feb 20 18:25:32 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D5307268073D16E9365CCFA9E0000, offsetMsgId=0A0D530700002A9F0000000000001F42, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=1], queueOffset=4]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>消费者接收日志如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Wed Feb 20 18:25:42 CST 2019],ConsumeMessageThread_3Receive New Messages :[MessageExt [queueId=1, storeSize=219, queueOffset=2, sysFlag=0, bornTimestamp=1550658332318, bornHost=/10.13.83.7:55682, storeTimestamp=1550658342322, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002026, commitLogOffset=8230, bodyCRC=705268097, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=3, CONSUME_START_TIME=1550658342325, UNIQ_KEY=0A0D5307268073D16E9365CCFA9E0000, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=1}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 48], transactionId='null'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以发现发送消息的时间和接收消息的时间相差10秒；</p> <h3 id="_2-顺序消息"><a href="#_2-顺序消息" class="header-anchor">#</a> 2.顺序消息</h3> <p>顺序消息指生产者生产数据的顺序和消费者消费数据的顺序是一致的；顺序消息包括全局顺序消息和局部顺序消息，全局顺序消息指在某个Topic下所有消息都是顺序的，局部顺序消息指在Topic下的Message Queue中是顺序的；</p> <h4 id="_2-1全局顺序消息"><a href="#_2-1全局顺序消息" class="header-anchor">#</a> 2.1全局顺序消息</h4> <p>RocketMQ在默认情况下并不能保证有序，一个Topic下会指定多个读写队列，生产者会将消息写入任意的Message Queue中，同样消费者可能会启动多个线程同时处理数据，所以并不能保证顺序；如何保证全局顺序需要只有一个读队列一个写队列，然后需要保证生产者和消费者不能并发处理，以下做一个简单的实例验证；<br>
生产者顺序的发送5条数据：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_4Receive New Messages :[MessageExt [queueId=1, storeSize=219, queueOffset=3, sysFlag=0, bornTimestamp=1550713381399, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391403, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002575, commitLogOffset=9589, bodyCRC=705268097, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=4, CONSUME_START_TIME=1550713391405, UNIQ_KEY=0A0D5307418073D16E936914F6160000, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=1}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 48], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_5Receive New Messages :[MessageExt [queueId=2, storeSize=219, queueOffset=2, sysFlag=0, bornTimestamp=1550713381450, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391451, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002650, commitLogOffset=9808, bodyCRC=1561245975, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=3, CONSUME_START_TIME=1550713391453, UNIQ_KEY=0A0D5307418073D16E936914F64A0001, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=2}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 49], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_6Receive New Messages :[MessageExt [queueId=3, storeSize=219, queueOffset=4, sysFlag=0, bornTimestamp=1550713381455, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391460, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F000000000000272B, commitLogOffset=10027, bodyCRC=1141369005, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=5, CONSUME_START_TIME=1550713391463, UNIQ_KEY=0A0D5307418073D16E936914F64F0002, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=3}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 50], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_7Receive New Messages :[MessageExt [queueId=0, storeSize=219, queueOffset=4, sysFlag=0, bornTimestamp=1550713381462, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391464, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002806, commitLogOffset=10246, bodyCRC=855693371, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=5, CONSUME_START_TIME=1550713391490, UNIQ_KEY=0A0D5307418073D16E936914F6560003, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=0}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 51], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_8Receive New Messages :[MessageExt [queueId=1, storeSize=219, queueOffset=4, sysFlag=0, bornTimestamp=1550713381466, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391469, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F00000000000028E1, commitLogOffset=10465, bodyCRC=761548184, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=5, CONSUME_START_TIME=1550713391501, UNIQ_KEY=0A0D5307418073D16E936914F65A0004, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=1}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 52], transactionId='null'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以发现这5条数据分别写入了4个Message Queue中；再看一下消费者日志：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_4Receive New Messages :[MessageExt [queueId=1, storeSize=219, queueOffset=3, sysFlag=0, bornTimestamp=1550713381399, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391403, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002575, commitLogOffset=9589, bodyCRC=705268097, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=4, CONSUME_START_TIME=1550713391405, UNIQ_KEY=0A0D5307418073D16E936914F6160000, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=1}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 48], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_5Receive New Messages :[MessageExt [queueId=2, storeSize=219, queueOffset=2, sysFlag=0, bornTimestamp=1550713381450, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391451, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002650, commitLogOffset=9808, bodyCRC=1561245975, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=3, CONSUME_START_TIME=1550713391453, UNIQ_KEY=0A0D5307418073D16E936914F64A0001, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=2}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 49], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_6Receive New Messages :[MessageExt [queueId=3, storeSize=219, queueOffset=4, sysFlag=0, bornTimestamp=1550713381455, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391460, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F000000000000272B, commitLogOffset=10027, bodyCRC=1141369005, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=5, CONSUME_START_TIME=1550713391463, UNIQ_KEY=0A0D5307418073D16E936914F64F0002, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=3}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 50], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_7Receive New Messages :[MessageExt [queueId=0, storeSize=219, queueOffset=4, sysFlag=0, bornTimestamp=1550713381462, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391464, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002806, commitLogOffset=10246, bodyCRC=855693371, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=5, CONSUME_START_TIME=1550713391490, UNIQ_KEY=0A0D5307418073D16E936914F6560003, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=0}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 51], transactionId='null'}]]
Time [Thu Feb 21 09:43:11 CST 2019],ConsumeMessageThread_8Receive New Messages :[MessageExt [queueId=1, storeSize=219, queueOffset=4, sysFlag=0, bornTimestamp=1550713381466, bornHost=/10.13.83.7:55720, storeTimestamp=1550713391469, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F00000000000028E1, commitLogOffset=10465, bodyCRC=761548184, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest6, MAX_OFFSET=5, CONSUME_START_TIME=1550713391501, UNIQ_KEY=0A0D5307418073D16E936914F65A0004, WAIT=true, DELAY=3, TAGS=TagA, REAL_QID=1}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 52], transactionId='null'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>消费者启动了5个线程同时从4个Message Queue中读取数据，所有不能保证数据的顺序性；<br>
分别做如下改造：设置Topic的读写队列分别为1，可以直接去<a href="http://localhost:8080/#/topic" target="_blank" rel="noopener noreferrer">RocketMQ-console<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>去修改配置；然后设置消费者的处理线程数为1：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>consumer.setConsumeThreadMin(1);
consumer.setConsumeThreadMax(1);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>再次测试，生产者同样发送5条数据：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 09:59:49 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D53071A0873D16E93692457700000, offsetMsgId=0A0D530700002A9F0000000000002EF5, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=11]
Time [Thu Feb 21 09:59:49 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D53071A0873D16E93692457790001, offsetMsgId=0A0D530700002A9F0000000000002FA7, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=12]
Time [Thu Feb 21 09:59:49 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D53071A0873D16E936924577F0002, offsetMsgId=0A0D530700002A9F0000000000003059, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=13]
Time [Thu Feb 21 09:59:49 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D53071A0873D16E93692457850003, offsetMsgId=0A0D530700002A9F000000000000310B, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=14]
Time [Thu Feb 21 09:59:49 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D53071A0873D16E93692457880004, offsetMsgId=0A0D530700002A9F00000000000031BD, messageQueue=MessageQueue [topic=TopicTest6, brokerName=broker-a, queueId=0], queueOffset=15]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以发送所有的消息都写入了相同的队列，然后看消费者日志：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 09:59:49 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=11, sysFlag=0, bornTimestamp=1550714389360, bornHost=/10.13.83.7:58033, storeTimestamp=1550714389364, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002EF5, commitLogOffset=12021, bodyCRC=705268097, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=12, CONSUME_START_TIME=1550714389372, UNIQ_KEY=0A0D53071A0873D16E93692457700000, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 48], transactionId='null'}]]
Time [Thu Feb 21 09:59:49 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=12, sysFlag=0, bornTimestamp=1550714389369, bornHost=/10.13.83.7:58033, storeTimestamp=1550714389371, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000002FA7, commitLogOffset=12199, bodyCRC=1561245975, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=13, CONSUME_START_TIME=1550714389379, UNIQ_KEY=0A0D53071A0873D16E93692457790001, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 49], transactionId='null'}]]
Time [Thu Feb 21 09:59:49 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=13, sysFlag=0, bornTimestamp=1550714389375, bornHost=/10.13.83.7:58033, storeTimestamp=1550714389379, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000003059, commitLogOffset=12377, bodyCRC=1141369005, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=15, CONSUME_START_TIME=1550714389385, UNIQ_KEY=0A0D53071A0873D16E936924577F0002, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 50], transactionId='null'}]]
Time [Thu Feb 21 09:59:49 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=14, sysFlag=0, bornTimestamp=1550714389381, bornHost=/10.13.83.7:58033, storeTimestamp=1550714389382, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F000000000000310B, commitLogOffset=12555, bodyCRC=855693371, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=15, CONSUME_START_TIME=1550714389385, UNIQ_KEY=0A0D53071A0873D16E93692457850003, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 51], transactionId='null'}]]
Time [Thu Feb 21 09:59:49 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=15, sysFlag=0, bornTimestamp=1550714389384, bornHost=/10.13.83.7:58033, storeTimestamp=1550714389386, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F00000000000031BD, commitLogOffset=12733, bodyCRC=761548184, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest6', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=16, CONSUME_START_TIME=1550714389409, UNIQ_KEY=0A0D53071A0873D16E93692457880004, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 52], transactionId='null'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以发送所有的消息都被同一个线程处理，并且从同一个Message Queue中读取数据，可以保证数据的顺序性；</p> <h4 id="_2-2局部顺序消息"><a href="#_2-2局部顺序消息" class="header-anchor">#</a> 2.2局部顺序消息</h4> <p>生产者需要将相关业务的消息发送到同一个Message Queue，在消费端需要保证同一个Message Queue读取的消息不能被并发处理；<br>
生产者发送消息给同一个Message Queue可以通过MessageQueueSelector来实现：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SendResult sendResult = producer.send(msg, new MessageQueueSelector() {

        @Override
        public MessageQueue select(List&lt;MessageQueue&gt; mqs, Message msg, Object arg) {
            return mqs.get(0);
        }
}, i);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>通过在select放在中为msg指定固定的Message Queue，这里为了方便给所有的消息都指定第0个队列；<br>
消费者保证同一个Message Queue读取的消息不能被并发处理，通过MessageListenerOrderly实现：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>consumer.registerMessageListener(new MessageListenerOrderly() {
            
            @Override
            public ConsumeOrderlyStatus consumeMessage(List&lt;MessageExt&gt; msgs, ConsumeOrderlyContext context) {
                System.out.printf(&quot;Time [&quot; + new Date().toString() + &quot;],&quot; +Thread.currentThread().getName() + &quot;Receive New Messages :&quot; + msgs + &quot;%n&quot;);
                return ConsumeOrderlyStatus.SUCCESS;
            }
        });
        consumer.start();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>简单测试一下，分开看一下生产者和消费者日志：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 10:45:43 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D5307463C73D16E93694E5D8B0000, offsetMsgId=0A0D530700002A9F00000000000035E9, messageQueue=MessageQueue [topic=TopicTest7, brokerName=broker-a, queueId=0], queueOffset=5]
Time [Thu Feb 21 10:45:43 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D5307463C73D16E93694E5D940001, offsetMsgId=0A0D530700002A9F000000000000369B, messageQueue=MessageQueue [topic=TopicTest7, brokerName=broker-a, queueId=0], queueOffset=6]
Time [Thu Feb 21 10:45:43 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D5307463C73D16E93694E5D980002, offsetMsgId=0A0D530700002A9F000000000000374D, messageQueue=MessageQueue [topic=TopicTest7, brokerName=broker-a, queueId=0], queueOffset=7]
Time [Thu Feb 21 10:45:43 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D5307463C73D16E93694E5D9D0003, offsetMsgId=0A0D530700002A9F00000000000037FF, messageQueue=MessageQueue [topic=TopicTest7, brokerName=broker-a, queueId=0], queueOffset=8]
Time [Thu Feb 21 10:45:43 CST 2019],SendResult [sendStatus=SEND_OK, msgId=0A0D5307463C73D16E93694E5D9F0004, offsetMsgId=0A0D530700002A9F00000000000038B1, messageQueue=MessageQueue [topic=TopicTest7, brokerName=broker-a, queueId=0], queueOffset=9]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 10:45:56 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=5, sysFlag=0, bornTimestamp=1550717143436, bornHost=/10.13.83.7:63916, storeTimestamp=1550717143440, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F00000000000035E9, commitLogOffset=13801, bodyCRC=705268097, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest7', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=10, UNIQ_KEY=0A0D5307463C73D16E93694E5D8B0000, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 48], transactionId='null'}]]
Time [Thu Feb 21 10:45:56 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=6, sysFlag=0, bornTimestamp=1550717143444, bornHost=/10.13.83.7:63916, storeTimestamp=1550717143445, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F000000000000369B, commitLogOffset=13979, bodyCRC=1561245975, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest7', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=10, UNIQ_KEY=0A0D5307463C73D16E93694E5D940001, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 49], transactionId='null'}]]
Time [Thu Feb 21 10:45:56 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=7, sysFlag=0, bornTimestamp=1550717143448, bornHost=/10.13.83.7:63916, storeTimestamp=1550717143451, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F000000000000374D, commitLogOffset=14157, bodyCRC=1141369005, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest7', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=10, UNIQ_KEY=0A0D5307463C73D16E93694E5D980002, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 50], transactionId='null'}]]
Time [Thu Feb 21 10:45:56 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=8, sysFlag=0, bornTimestamp=1550717143453, bornHost=/10.13.83.7:63916, storeTimestamp=1550717143454, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F00000000000037FF, commitLogOffset=14335, bodyCRC=855693371, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest7', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=10, UNIQ_KEY=0A0D5307463C73D16E93694E5D9D0003, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 51], transactionId='null'}]]
Time [Thu Feb 21 10:45:56 CST 2019],ConsumeMessageThread_1Receive New Messages :[MessageExt [queueId=0, storeSize=178, queueOffset=9, sysFlag=0, bornTimestamp=1550717143455, bornHost=/10.13.83.7:63916, storeTimestamp=1550717143456, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F00000000000038B1, commitLogOffset=14513, bodyCRC=761548184, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic='TopicTest7', flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=10, UNIQ_KEY=0A0D5307463C73D16E93694E5D9F0004, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 52], transactionId='null'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-事务消息"><a href="#_3-事务消息" class="header-anchor">#</a> 3.事务消息</h3> <p>事务消息是指RocketMQ发送的消息和其他本地事件需要同时成功同时失败，可以理解为就是分布式事务；RocketMQ处理事务消息的大致流程如下：<br>
1.生产者发送&quot;待确认&quot;消息；<br>
2.RocketMQ接收到消息进行相关保存操作，成功以后返回状态给生产者；<br>
3.生产者接收到的返回如果为SEND_OK状态，将执行本地事务操作；<br>
4.根据本地事务执行的结果，生产者执行commit还是rollback；<br>
5.如果第四步生产者执行操作失败，服务器会在经过固定时间段对状态为&quot;待确认&quot;的消息发起回查请求；<br>
6.生产者接收到回查请求后根据本地事务的结果返回commit还是rollback；<br>
7.服务器收到结果后执行相关操作。</p> <p>接下来看一下官方提供的实例<br>
TransactionProducerTest生产者类，类似DefaultMQProducer，主要设置了一个事务监听器类TransactionListener，用于开始本地事务会给服务器的回查接口；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class TransactionProducerTest {
    public static void main(String[] args) throws MQClientException, InterruptedException {
        TransactionListener transactionListener = new TransactionListenerImpl();
        TransactionMQProducer producer = new TransactionMQProducer(&quot;transactionProducerGroupName&quot;);
        producer.setNamesrvAddr(&quot;192.168.237.128:9876&quot;);
        ExecutorService executorService = new ThreadPoolExecutor(2, 5, 100, TimeUnit.SECONDS,
                new ArrayBlockingQueue&lt;Runnable&gt;(2000), new ThreadFactory() {
                    @Override
                    public Thread newThread(Runnable r) {
                        Thread thread = new Thread(r);
                        thread.setName(&quot;client-transaction-msg-check-thread&quot;);
                        return thread;
                    }
                });

        producer.setExecutorService(executorService);
        producer.setTransactionListener(transactionListener);
        producer.start();

        String[] tags = new String[] { &quot;TagA&quot;, &quot;TagB&quot;, &quot;TagC&quot;, &quot;TagD&quot;, &quot;TagE&quot; };
        for (int i = 0; i &lt; 1; i++) {
            try {
                Message msg = new Message(&quot;TopicTest1234&quot;, tags[i % tags.length], &quot;KEY&quot; + i,
                        (&quot;Hello RocketMQ &quot; + i).getBytes(RemotingHelper.DEFAULT_CHARSET));
                System.out.println(&quot;start send message &quot; + msg);
                SendResult sendResult = producer.sendMessageInTransaction(msg, null);
                System.out.printf(&quot;%s%n&quot;, sendResult);

                Thread.sleep(10);
            } catch (MQClientException | UnsupportedEncodingException e) {
                e.printStackTrace();
            }
        }

        for (int i = 0; i &lt; 100000; i++) {
            Thread.sleep(1000);
        }
        producer.shutdown();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>还有一个监听器类TransactionListenerImpl</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class TransactionListenerImpl implements TransactionListener {
    private AtomicInteger transactionIndex = new AtomicInteger(0);

    private ConcurrentHashMap&lt;String, Integer&gt; localTrans = new ConcurrentHashMap&lt;&gt;();

    @Override
    public LocalTransactionState executeLocalTransaction(Message msg, Object arg) {
        System.out.println(&quot;executeLocalTransaction&quot;);
        int value = transactionIndex.getAndIncrement();
        int status = value % 3;
        localTrans.put(msg.getTransactionId(), status);
        return LocalTransactionState.UNKNOW;
    }

    @Override
    public LocalTransactionState checkLocalTransaction(MessageExt msg) {
        Integer status = localTrans.get(msg.getTransactionId());
        System.out.println(&quot;checkLocalTransaction:status = &quot; + status);
        if (null != status) {
            switch (status) {
            case 0:
                return LocalTransactionState.UNKNOW;
            case 1:
                return LocalTransactionState.COMMIT_MESSAGE;
            case 2:
                return LocalTransactionState.ROLLBACK_MESSAGE;
            default:
                return LocalTransactionState.COMMIT_MESSAGE;
            }
        }
        return LocalTransactionState.COMMIT_MESSAGE;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>以上监听器需要实现两个接口方法，分别是执行本地事务的方法和用于被服务器回调的方法；运行以上生产者相关日志如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>start send message Message{topic='TopicTest1234', flag=0, properties={KEYS=KEY0, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 32, 48], transactionId='null'}
executeLocalTransaction
SendResult [sendStatus=SEND_OK, msgId=0A0D5307383473D16E936A31CF040000, offsetMsgId=null, messageQueue=MessageQueue [topic=TopicTest1234, brokerName=broker-a, queueId=2], queueOffset=47]
checkLocalTransaction:status = 0
checkLocalTransaction:status = 0
checkLocalTransaction:status = 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>从日志可以看出，首先发送&quot;待确认&quot;消息，发送返回为SEND_OK；然后执行本地事务，实例中返回的是一个LocalTransactionState.UNKNOW状态，导致服务器一直调用回查方法checkLocalTransaction，同时消费端一直没有消息被消费；做简单代码改动，将本地事务的执行结果改成LocalTransactionState.COMMIT_MESSAGE，生产者消费者日志如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>start send message Message{topic='TopicTest1234', flag=0, properties={KEYS=KEY0, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 32, 48], transactionId='null'}
executeLocalTransaction
SendResult [sendStatus=SEND_OK, msgId=0A0D530740F073D16E936A3A2DC10000, offsetMsgId=null, messageQueue=MessageQueue [topic=TopicTest1234, brokerName=broker-a, queueId=2], queueOffset=58]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>Time [Thu Feb 21 15:03:17 CST 2019],ConsumeMessageThread_3Receive New Messages :[MessageExt [queueId=2, storeSize=278, queueOffset=0, sysFlag=8, bornTimestamp=1550732597697, bornHost=/10.13.83.7:55029, storeTimestamp=1550732597758, storeHost=/10.13.83.7:10911, msgId=0A0D530700002A9F0000000000008853, commitLogOffset=34899, bodyCRC=613185359, reconsumeTimes=0, preparedTransactionOffset=34610, toString()=Message{topic='TopicTest1234', flag=0, properties={MIN_OFFSET=0, REAL_TOPIC=TopicTest1234, MAX_OFFSET=1, KEYS=KEY0, TRAN_MSG=true, UNIQ_KEY=0A0D530740F073D16E936A3A2DC10000, WAIT=true, PGROUP=transactionProducerGroupName, TAGS=TagA, REAL_QID=2}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 32, 48], transactionId='0A0D530740F073D16E936A3A2DC10000'}]]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以看到消息状态在服务器端被修改，这样消费端就可以消费此消息；</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>本文首先介绍了RocketMQ发送消息的通讯模式，然后重点介绍了延迟消息，顺序消息以及事务消息，并且结合实例进行分析.</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <div class="tags"><a href="/xpai/tags/?tag=RocketMQ" title="标签">#RocketMQ</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/06/27, 14:58:18</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/xpai/pages/37e0fd/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">RocketMQ生产者流程篇</div></a> <a href="/xpai/pages/5a3e14/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">从RocketMQ看长轮询</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/xpai/pages/37e0fd/" class="prev">RocketMQ生产者流程篇</a></span> <span class="next"><a href="/xpai/pages/5a3e14/">从RocketMQ看长轮询</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/xpai/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/xpai/pages/f8e1fa/"><div>开发者如何在技术+管理的路上越走越宽？</div></a> <span>06-27</span></dt></dl><dl><dd>02</dd> <dt><a href="/xpai/pages/37e0fd/"><div>RocketMQ生产者流程篇</div></a> <span>06-27</span></dt></dl><dl><dd>03</dd> <dt><a href="/xpai/pages/a81d2c/"><div>你对线程隔离的理解</div></a> <span>06-27</span></dt></dl> <dl><dd></dd> <dt><a href="/xpai/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:619147075@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Ezuy-Lee/" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=966099149" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2021
    <span>Rainze-Lee | <a href="https://github.com/Ezuy-Lee/Rainze-Blog/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/xpai/assets/js/app.463a16ef.js" defer></script><script src="/xpai/assets/js/2.86da3580.js" defer></script><script src="/xpai/assets/js/125.3c3c7cbd.js" defer></script>
  </body>
</html>
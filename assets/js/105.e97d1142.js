(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{530:function(s,a,e){"use strict";e.r(a);var n=e(15),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"搭建elk环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#搭建elk环境"}},[s._v("#")]),s._v(" 搭建ELK环境")]),s._v(" "),e("h2",{attrs:{id:"安装elasticsearch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装elasticsearch"}},[s._v("#")]),s._v(" 安装elasticsearch")]),s._v(" "),e("h3",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),e("p",[s._v("许多年前，一个刚结婚的名叫shay Banon的失业开发者，跟着他的妻子去了伦敦，他的妻子在那里 学习厨师。为了给他的妻子做一个食谱搜索引擎，他开始使用Lucene的一个早期版本。直接使用 Lucene是很难的，因此Shay开始做一个抽象层，Java开发者使用它可以很简单的给他们的程序添加 搜索功能。他发布了他的第一个开源项目Compass。")]),s._v(" "),e("p",[s._v("后来Shay获得了一份工作，主要是高性能，分布式环境下的内存数据网格。这个对于高性能，实 时，分布式搜索引擎的需求尤为突出，他决定重写Compass,把它变为一个独立的服务并取名 Elasticsearch。")]),s._v(" "),e("p",[s._v("第一^公开版本在2010年2月发布，从此以后，Elasticsearch已经成为了 Github上最活跃的项 目之一，他拥有超过300名contributors（目前736名contributors ）。一家公司已经开始围绕 Elasticsearch提供商业服务，并开发新的特性，但是，Elasticsearch将永远开源并对所有人可 用。")]),s._v(" "),e("p",[s._v("据说，Shay的妻子还在等着她的食谱搜索引擎...0_0!")]),s._v(" "),e("p",[s._v("Elasticsearch是一个开源的搜索引擎，建立在一个全文搜索引擎库Lucene基础之上。Lucene可 以说是当下最先进、高性能、全功能的搜索引擎库，缺点是Lucene的使用非常的复杂。Elasticsearch 也是使用Java编写的，它的内部使用Lucene做索引与搜索，但是它的目的是使全文检索变得简单， 通过隐藏Lucene的复杂性，取而代之的提供一套简单一致的RESTful API。")]),s._v(" "),e("h3",{attrs:{id:"相关链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[s._v("#")]),s._v(" 相关链接")]),s._v(" "),e("p",[s._v("官网：")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.elastic.co/cn/downloads/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www .elastic .co/cn/downloads/elasticsea rch"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("下载：")]),s._v(" "),e("p",[s._v("wget"),e("a",{attrs:{href:"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-linux-x86_64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.1-linux-x86 64.tar.gz"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("分词器：")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github .com/medcl/elasticsea rch-analysis-ik"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),e("p",[s._v("系统环境：以下课程假设测试机器ip为172.17.0.203")]),s._v(" "),e("p",[s._v("解压：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tar xvf elasticsearch-7.5.1-linux-x86_64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("修改:")]),s._v(" "),e("p",[s._v("config/elasticsearch.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('#主机名，通过hostname命令查询到 cluster.initial_master_nodes : ["主机名"]\nnetwork.host: 0.0.0.0 \nhttp.port: 9200 \nhttp.cors.enabled: true \nhttp.cors.allow-origin: "*"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("修改文件描述符:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vim /etc/sysctl.conf\n\nvm.max_map_count=64000 \n\nsysctl -p\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("启动:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#es不允许root用户启动，需要添加新用户身份\n#创建elsearch用户组及elsearch用户\ngroupadd elsearch\nuseradd elsearch -g elsearch -p elasticsearch\n#更改elasticsearch文件夹及内部文件的所属用户及组为elsearch:elsearch\nchown -R elsearch:elsearch ./opt/elk/elasticsearch-7.5.1\n#切换到elsearch用户再启动\nsu elsearch\n#守护进程运行\n./bin/elasticsearch -d\n#验证启动进程\nps aux | grep elasticsearch\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("删除用户：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" [root@localhost /]# userdel -r 用户名\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("验证:")]),s._v(" "),e("p",[s._v("访问"),e("a",{attrs:{href:"http://172.17.0.203:9200/",target:"_blank",rel:"noopener noreferrer"}},[s._v(" http://172.17.0.203:9200"),e("OutboundLink")],1),s._v(" ,启动成功")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iZbp14sp42lwvcxdmqw61zZ"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_name"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_uuid"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VCOf0wUGTMajBPc3Q-KSew"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.5.1"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_flavor"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_type"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tar"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_hash"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3ae9ac9a93c95bd0cdc054951cf95d88e1e18d96"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_date"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2019-12-16T22:57:37.835892Z"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_snapshot"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lucene_version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.3.0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum_wire_compatibility_version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.8.0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum_index_compatibility_version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.0.0-beta1"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tagline"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"You Know, for Search"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"中文分词器安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#中文分词器安装"}},[s._v("#")]),s._v(" 中文分词器安装")]),s._v(" "),e("p",[s._v("es默认分词器对中文分词非常不友好，需要安装ik分词器")]),s._v(" "),e("p",[s._v("Analyzer: ik_smart , ik_max_word , Tokenizer: ik_smart , ik_max_word")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("wget -c https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.5.1/elasticsearch-analysis-ik-7.5.1.zip\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在es安装目录下面的plus文件夹下面创建 ik 文件夹 ，将下载的文件解压到此目录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir $ES_HOME/plugins/ik\nunzip elasticsearch-analysis-ik-7.5.1.zip -d $ES_HOME/plugins/ik\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("安装完成重启es")]),s._v(" "),e("p",[s._v("验证分词器：")]),s._v(" "),e("p",[s._v("POST:"),e("a",{attrs:{href:"http://172.17.0.203:9200/_analyze",target:"_blank",rel:"noopener noreferrer"}},[s._v(" http：//172.17.0.203:9200/ analyze"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v('BODY: {"text":"测试分词效果"‘"analyze r": "ik_sma rt"}')]),s._v(" "),e("p",[s._v("指令：curl"),e("a",{attrs:{href:"http://localhost:9200/_analyze",target:"_blank",rel:"noopener noreferrer"}},[s._v(" http://localhost:9200/ analyze "),e("OutboundLink")],1),s._v("-X POST -H 'Content-Type:application/json' -d")]),s._v(" "),e("p",[s._v('\'{"text":"test elasticsea rch 测试分词效果"‘"analyze r": "ik_sma rt"}\'')]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('RESULT："tokens": [\n{\n"token": "test", "start_offset": 0, "end_offset": 4, "type": "ENGLISH", "position": 0\n},\n{\n"token": "elasticsearch", "start_offset": 5, "end_offset": 18, "type": "ENGLISH", "position": 1\n},\n{\n"token":"测试"， "start_offset": 19, "end_offset": 21， "type": "CN_WORD"， "position": 2\n}，\n{\n"token":"分词"， "start_offset": 21， "end_offset": 23， "type": "CN_WORD"， "position": 3\n}，\n{\n"token":"效果"， "start_offset": 23， "end_offset": 25， "type": "CN_WORD"， "position": 4\n}\n]\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("注意：")]),s._v(" "),e("p",[s._v("Elasticsearch集成analysis ik中文分词器 时出现：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Plugin [analysis-ik] was built for Elasticsearch version 6.5.0 but version 6.7.1 is running.....\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("问题原因是：Es 版本和 ik分词器版本不一致。由于我用的Es时最新版本 6.7.1，而ik分词器master编译出来也只是6.5.0")]),s._v(" "),e("p",[s._v("修改 plugin-descriptor.properties 文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("elasticsearch.version=你的ES版本号\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"安装es-head"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装es-head"}},[s._v("#")]),s._v(" 安装es-head")]),s._v(" "),e("p",[s._v("我们可以方便的使用curl等客户端工具，通过Restful API对Elasticsea rch进行操作，但也有一些客 户端工具提供对于ElasticSearch更加友好的可视化操作支持，elasticsearch-head就是其中很优秀的代 表。")]),s._v(" "),e("p",[s._v("早期版本的elasticsea rch-head可以直接以插件的方式在Elasticsea rch中进行安装，在 Elasticsea rch 5之后则需要将elasticsea rch-head服务单独运行，并且支持Chr ome的插件方式或者 Docke r容器运行方式。")]),s._v(" "),e("p",[s._v("部署")]),s._v(" "),e("p",[s._v("#采用docker启动")]),s._v(" "),e("p",[s._v("#查看镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker images | grep elasticsearch-head\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("#下载镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker pull alivv/elasticsearch-head\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("#启动")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run -d --name eshead -p 9100:9100 alivv/elasticsearch-head\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("验证：")]),s._v(" "),e("p",[s._v("访问910 0端口，并连接es地址:")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/QQ%E6%88%AA%E5%9B%BE20210125174540.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"logstash安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logstash安装"}},[s._v("#")]),s._v(" logstash安装")]),s._v(" "),e("h3",{attrs:{id:"简介-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介-2"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),e("p",[s._v("Logstash诞生于2009年8有2日，其作者是世界著名的虚拟主机托管商Dr eamHost的运维工程师Jordan Sissel。在2013年，被ElasticSearch公司收购，作为日志收集工具，成为elk的一员。")]),s._v(" "),e("p",[s._v("相关链接")]),s._v(" "),e("p",[s._v("项目主页：")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.elastic.co/cn/downloads/logstash",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www .elastic .co/cn/downloads/logstash"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("下载地址：")]),s._v(" "),e("p",[s._v("wget"),e("a",{attrs:{href:"https://artifacts.elastic.co/downloads/logstash/logstash-7.5.1.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v(" https://a rtifacts .elastic .co/downloads/logstash/logstash-7.5.1 ・ta r.gz"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"部署-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-2"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),e("p",[s._v("解压：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tar xvf logstash-7.5.1.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("配置：")]),s._v(" "),e("p",[s._v("（案例一）在conf.d目录下新建一个configl .conf文件，用于监听es中的数据内容")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input {\nfile {\npath => "/root/logs/*.log" start_position => beginning add_field => {"from" => "localfile"} }\n}\nfilter {\n} output { elasticsearch {\nhosts => "localhost:9200"\nindex => "mylog"\n}\nstdout {\n}\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("验证：")]),s._v(" "),e("p",[s._v("#生成一条测试日志数据，从es-head验证是否正常采集")]),s._v(" "),e("p",[s._v("mkdir -p /root/logs/")]),s._v(" "),e("p",[s._v("date >> /root/logs/1.log")]),s._v(" "),e("p",[s._v("（案例二）监听tomcat的日志")]),s._v(" "),e("p",[s._v("进入logstash的bin目录")]),s._v(" "),e("p",[s._v("新建文件 vim logstash1.conf ，写入内容(监听tomcat的日志)：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input {\n    file {\n        path => "/usr/share/tomcat/logs/*.log"\n        start_position => beginning\n    }\n}\nfilter {\n \n}\noutput {\n    elasticsearch {\n    hosts => "localhost:9200"\n    }\n \n}\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("启动logstash：sh logstash -f logstash1.conf  &")]),s._v(" "),e("p",[s._v("如果提示--path.data的问题，则需要指定path.data的路径，随便找个路径就行，")]),s._v(" "),e("p",[s._v("我的是这样启动：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sh logstash -f logstash1.conf  --path.data=/opt/elk/logstash-7.5.1/logs &\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("（案例三）logstash配置mysql数据同步到elasticsearch")]),s._v(" "),e("p",[s._v("获取 jdbc mysql 驱动：")]),s._v(" "),e("p",[s._v("wget https://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.46.zip unzip mysql-connector-java-5.1.46.zip")]),s._v(" "),e("p",[s._v("可以把解压后的mysql-connector-java-5.1.46-bin.jar复制到bin目录，方便启动")]),s._v(" "),e("p",[s._v("在bin目录新建配置文件   vim mysql-logstash.cnf ，写入：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input {\n  jdbc {\n    jdbc_driver_library => "mysql-connector-java-5.1.46-bin.jar"\n    jdbc_driver_class => "com.mysql.jdbc.Driver"\n    jdbc_connection_string => "jdbc:mysql://ip:3306/db_name"\n    jdbc_user => "jdbc_user"\n    jdbc_password => "jdbc_password"\n    schedule => "* * * * *"\n    statement => "SELECT * FROM table WHERE 时间字段 >= :sql_last_value"\n    use_column_value => true\n    tracking_column_type => "timestamp"\n    tracking_column => "时间字段"\n    last_run_metadata_path => "syncpoint_table"\n  }\n}\n \n \noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    index => "索引名称"\n    document_id => "%{主键字段}"\n  }\n}\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("需要先把logstash停了，在重启")]),s._v(" "),e("p",[s._v("netstat -ntlp  命令查看端口为9600的进程，")]),s._v(" "),e("p",[s._v("使用命令 sh logstash -f mysql-logstash.cnf --path.data=/opt/elk/logstash-7.5.1/logs &")]),s._v(" "),e("h2",{attrs:{id:"kibana安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kibana安装"}},[s._v("#")]),s._v(" kibana安装")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/kibana.jpg",alt:""}})]),s._v(" "),e("p",[s._v("相关链接")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.elastic.co/cn/downloads/kibana",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www .elastic .co/cn/downloads/kibana"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("a",{attrs:{href:"https://artifacts.elastic.co/downloads/kibana/kibana-7.5.1-linux-x86_64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://artifacts.elastic.co/downloads/kibana/kibana-7.5.1 -linux-x86 64.tar.gz"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("安装部署")]),s._v(" "),e("p",[s._v("解压：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tar xvf kibana-7.5.1-linux-x86_64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("配置：")]),s._v(" "),e("p",[s._v("config/kibana.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('server.port:\t9102\nserver.host:\t"0.0.0.0"\nelasticsearch.hosts: "http://localhost:9200 kibana.index: ".kibana"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("启动:")]),s._v(" "),e("p",[s._v("#kibana默认不允许root用户启动，可以加--allow-root选项")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("nohup sh /opt/elk/kibana-7.5.1-linux-x86_64/bin/kibana --allow-root >/opt/logs/kibana.log &\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("验证:")]),s._v(" "),e("p",[s._v("启动成功，数据为空，向es提交一条数据，通过es-head查询，并通过logstash查询类比展示下面logstash搭建完成后，会再次展示通过采集进入的数据。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/QQ%E6%88%AA%E5%9B%BE20210125180202.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"kafka安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka安装"}},[s._v("#")]),s._v(" kafka安装")]),s._v(" "),e("p",[s._v("Kafka是最初由Linkedin公司开发，是一个分布式、分区的、多副本的、多订阅者，基于zookeepe r协调 的分布式日志系统（也可以当做MQ系统），常见可以用于web/nginx日志、访问日志，消息服务等 等，Linkedin于2010年贡献给了Apache基金会并成为顶级开源项目。常用于日志处理场景。")]),s._v(" "),e("p",[s._v("资源")]),s._v(" "),e("p",[e("a",{attrs:{href:"http://kafka.apache.org/downloads",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://kafka.apache. or g/downloads"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("docker 部署")]),s._v(" "),e("p",[s._v("kafka和zk的镜像拉取省略。。。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('docker run --name zookeeper -v /opt/data/zksingle:/data -p 2181:2181 -e ZOO_LOG4J_PROP="INFO,ROLLINGFILE" -d zookeeper:latest\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动kafka")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker run -d --name kafka -p 9103:9092 --link zookeeper:zookeeper --env KAFKA_BROKER_ID=100 --env HOST_IP=47.110.229.77 --env KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181 --env KAFKA_ADVERTISED_HOST_NAME=47.110.229.77 --env KAFKA_ADVERTISED_PORT=9103 --restart=always --volume /etc/localtime:/etc/localtime wurstmeister/kafka:2.11-0.11.0.3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("验证")]),s._v(" "),e("p",[s._v("#使用zk节点数据验证启动情况")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker exec -it zookeeper sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("#进入zookeeper后查看节点信息")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ls /brokers\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("#进入容器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker exec -it kafka sh\n\n/opt/kafka_2.12-2.2.2/bin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("#客户端监听（该步会自动创建topic）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic demo -- from-beginning\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("#另起一个终端，验证发送")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("./kafka-console-producer.sh --broker-list localhost:9092 --topic demo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("5）实例操作")]),s._v(" "),e("p",[s._v("修改logstash从kafka获取，从控制台重新写入一条日志，进kibana查看数据展示情况")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input { file {\n\npath => "/root/logs/*.log" \n\nstart_position => beginning add_field => {"from" => "localfile"}\n\n}\n\nkafka { bootstrap_servers => ["39.98.133.153:9103"] group_id => "logstash" topics => ["demo"] consumer_threads => 1 decorate_events => true add_field => {"from" => "demo"}\n\n}\n\n} filter {\n\n}\n\noutput {\n\nelasticsearch {\n\nhosts => "localhost:9200"\n\nindex => "mylog"\n\n}\n\nstdout {\n\n}\n\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("h3",{attrs:{id:"kafkamanager安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafkamanager安装"}},[s._v("#")]),s._v(" kafkamanager安装")]),s._v(" "),e("p",[s._v("kafka-manage r是目前最受欢迎的kafka集群管理工具，最早由雅虎开源，用户可以在Web界面执 行一些简单的集群管理操作。具体支持以下内容：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("管理多个集群")])]),s._v(" "),e("li",[e("p",[s._v("轻松检查群集状态（主题，消费者，偏移，代理，副本分发，分区分发）")])]),s._v(" "),e("li",[e("p",[s._v("运行首选副本选举")])]),s._v(" "),e("li",[e("p",[s._v("使用选项生成分区分配以选择要使用的代理")])]),s._v(" "),e("li",[e("p",[s._v("运行分区重新分配（基于生成的分配）")])]),s._v(" "),e("li",[e("p",[s._v("使用可选主题配置创建主题（0.8.1.1具有与0.8.2+不同的配置）")])]),s._v(" "),e("li",[e("p",[s._v("删除主题（仅支持0.8.2+并记住在代理配置中设置delete.topic.enable = tr ue）")])]),s._v(" "),e("li",[e("p",[s._v("主题列表现在指示标记为删除的主题（仅支持0.8.2+）")])]),s._v(" "),e("li",[e("p",[s._v("批量生成多个主题的分区分配，并可选择要使用的代理")])]),s._v(" "),e("li",[e("p",[s._v("批量运行重新分配多个主题的分区")])]),s._v(" "),e("li",[e("p",[s._v("将分区添加到现有主题")])]),s._v(" "),e("li",[e("p",[s._v("更新现有主题的配置")])])]),s._v(" "),e("p",[s._v("资源")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/yahoo/kafka-manager/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/yahoo/kafka-manage r/r eleases"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("docke r库里的版本太陈旧，需要从官网下载源码包，编译成二进制包。具体编译过程参考项目主页 下面的Deployment章节。")]),s._v(" "),e("p",[s._v("部署中直接使用打好包的kafka-manager-2.0O2.zip, manage版本为2.0.0.2,配置kafka cluster 最高支持2.2.0，实际验证，可以•操作kafka 2.2.2")]),s._v(" "),e("p",[s._v("3）部署")]),s._v(" "),e("p",[s._v("#解压")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("unzip kafka-manager-2.0.0.2.zip\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v('#配置文件，修改目录下的conf/application.conf kafka-manager.zkhosts="localhost:2181"')]),s._v(" "),e("p",[s._v("#启动，指定端口 9104")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("km_home=./kafka-manager-2.0.0.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("nohup $km_home/bin/kafka-manager -Dconfig.file=$km_home/conf/application.conf - Dhttp.port=9104 > /opt/logs/kibana.log &\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tail -f /opt/logs/kibana.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("4功能说明")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("cluste r创建与管理")])]),s._v(" "),e("li",[e("p",[s._v("Br oke rs信息查看")])]),s._v(" "),e("li",[e("p",[s._v("topic创建与管理")])]),s._v(" "),e("li",[e("p",[s._v("patte rn 及 r eplica 配置")])])]),s._v(" "),e("h2",{attrs:{id:"filebeat安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#filebeat安装"}},[s._v("#")]),s._v(" Filebeat安装")]),s._v(" "),e("p",[s._v("简介")]),s._v(" "),e("p",[s._v("Filebeat是一个轻量级日志传输Agent，可以•将指定日志转发到Logstash, Elasticsearch、Kafka、 Redis等中。Filebeat占用资源少，而且安装配置也比较简单，支持目前各类主流OS及Docker平台。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/QQ%E6%88%AA%E5%9B%BE20210125181351.png",alt:""}})]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.elastic.co/cn/products/beats/filebeat",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www .elastic .co/cn/p roducts/beats/filebeat"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("下载：")]),s._v(" "),e("p",[s._v("wget"),e("a",{attrs:{href:"https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.5.1-linux-x86_64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v(" https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.5.1-linux-x86 64.tar.gz"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("部署")]),s._v(" "),e("p",[s._v("解压：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tar zxvf filebeat-7.5.1-linux-x86_64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用kafka-manage r创建一个filebeat队列")]),s._v(" "),e("p",[s._v("配置 filebeat .yml：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('filebeat.inputs:\n\n\\- type: log\n\nenabled: true\n\npaths:\n\n\\- /root/logs/*.log fields:\n\nfrom: filebeat \n\noutput.kafka:\n\nenabled: true\n\nhosts: ["39.98.133.153:9103"]\n\ntopic: filebeat\n\ncompression: gzip\n\nprocessors:\n\n\\- drop_fields: fields: ["beat", "input", "source",\n\n"offset","metadata","timestamp","agent","ecs","fields"]\n\nfilebeat.config.modules:\n\npath: ${path.config}/modules.d/*.yml\n\nreload.enabled: true\n\nlogging.level: info\n\nname: filebeat-server-ip\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br")])]),e("p",[s._v("启动：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd /opt/app/elk/filebeat-7.5.1-linux-x86_64\n\nnohup ./filebeat -e -c filebeat.yml >> /opt/logs/filebeat.log &\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tail -f /opt/logs/filebeat.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("4）验证")]),s._v(" "),e("p",[s._v("修改logstash，去掉file采集，接收来自filebeat队列的消息。")]),s._v(" "),e("p",[s._v("请注意！这里有一个问题：filebeat默认读取字符后，输出的是json格式，上述codec即让logstash解析")]),s._v(" "),e("p",[s._v("json,但是仍会报错。原因是filebeat里的host.name属性，需要加入filter,合并属性名字：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('input {\n\nkafka {\n\nbootstrap_servers => ["39.98.133.153:9103"]\n\ngroup_id => "logstash"\n\ntopics => ["filebeat"] consumer_threads => 1 decorate_events => true add_field => {"from" => "filebeat"} codec => "json"\n\n}\n\n}\n\nfilter {\n\nmutate {\n\nrename => { "[host][name]" => "host" }\n\n重新录入一条日志信息仅log文件，查看logstash stdout日志，查看kibana是否正常采集入es 附：filebeat输出json格式参考范本\n\n{\n\n"@timestamp": "2019-05-11T07:55:02.127Z", "@metadata": {\n\n"beat": "filebeat", "type": "_doc", "version": "7.5.1", "topic": "app.log"\n\n},\n\n"ecs": { "version": "1.0.0"\n\n},\n\n"log": { "offset": 2661796, "file": {\n\n"path": "/var/log/app.log"\n\n}\n\n},\n\n"message": "05-11 00:10:19.851[DEBUG][http-nio-39545-exec-9] ", "fields": {\n\n"log_topic": "app.log"\n\n},\n\n"host": { "name": "172.33.12.109"\n\n}, "agent": { "id": "6a86e9d9-e1e8-4b32-b027-f1c936f66e4f", "version": "7.0.1", "name": "172.33.12.109", "type": "filebeat",\n\n"ephemeral_id": "8326a240-e9de-44f4-b24d-a1c8d2654e19", "hostname": "client-ali"\n\n}\n\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/elk_10.png",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/elk_11.png",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/elk_12.png",alt:""}})])])}),[],!1,null,null,null);a.default=t.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{540:function(a,s,t){"use strict";t.r(s);var e=t(15),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"分布式文件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分布式文件系统"}},[a._v("#")]),a._v(" 分布式文件系统")]),a._v(" "),t("h3",{attrs:{id:"_1-1-技术应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-技术应用场景"}},[a._v("#")]),a._v(" 1.1 技术应用场景")]),a._v(" "),t("p",[a._v("传智播客拥有大量优质的视频教程，并且免费提供给用户去下载，文件太多如何高效存储？用户访问量大如何保证下载速度？今天讲解的分布式文件系统将解决这些问题。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image005.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1.2 什么是分布式文件系统")]),a._v(" "),t("p",[a._v("1.2.1什么是文件系统   引用“百度百科”中的描述：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image008.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("总结：文件系统是负责管理和存储文件的系统软件，它是操作系统和硬件驱动之间的桥梁，操作系统通过文件系统提供的接口去存取文件，用户通过操作系统访问磁盘上的文件。如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image010.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("常见的文件系统：FAT16/FAT32、NTFS、HFS、UFS、APFS、XFS、Ext4等 。")]),a._v(" "),t("p",[a._v("思考：如果没有文件系统我们该怎么管理自己的文件？")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image011.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1.2.2什么是分布式文件系统  引用“百度百科”中的描述：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image013.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("为什么会有分布文件系统呢？")]),a._v(" "),t("p",[a._v("分布式文件系统是面对互联网的需求而产生，互联网时代对海量数据如何存储？靠简单的增加硬盘的个数已经满足不了我们的要求，因为硬盘传输速度有限但是数据在急剧增长，另外我们还要要做好数据备份、数据安全等。采用分布式文件系统可以将多个地点的文件系统通过网络连接起来，组成一个文件系统网络，结点之间通过网络进行通信，一台文件系统的存储和传输能力有限，我们让文件在多台计算机上存储，通过多台计算共同传输。如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image014.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("好处：")]),a._v(" "),t("p",[a._v("1、  一台计算机的文件系统处理能力扩充到多台计算机同时处理。")]),a._v(" "),t("p",[a._v("2、  一台计算机挂了还有另外副本计算机提供数据。")]),a._v(" "),t("p",[a._v("3、  每台计算机可以放在不同的地域，这样用户就可以就近访问，提高访问速度。")]),a._v(" "),t("h3",{attrs:{id:"_1-3-主流的分布式文件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-主流的分布式文件系统"}},[a._v("#")]),a._v(" 1.3 主流的分布式文件系统")]),a._v(" "),t("p",[a._v("1、NFS")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image016.jpg",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image017.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1）  在客户端上映射NFS服务器的驱动器。")]),a._v(" "),t("p",[a._v("2）  客户端通过网络访问NFS服务器的硬盘完全透明。")]),a._v(" "),t("p",[a._v("2、GFS")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image020.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("1）GFS采用主从结构，一个GFS集群由一个master和大量的chunkserver组成。 2）master存储了数据文件的元数据，一个文件被分成了若干块存储在多个chunkserver中。")]),a._v(" "),t("p",[a._v("3）用户从master中获取数据元信息，从chunkserver存储数据。")]),a._v(" "),t("p",[a._v("3、HDSF")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image022.jpg",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image024.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1）  HDFS采用主从结构，一个HDFS集群由一个名称结点和若干数据结点组成。名称结点存储数据的元信息，一个完整的数据文件分成若干块存储在数据结点。")]),a._v(" "),t("p",[a._v("2）  客户端从名称结点获取数据的元信息及数据分块的信息，得到信息客户端即可从数据块来存取数据。")]),a._v(" "),t("h3",{attrs:{id:"_1-4分布式文件服务提供商"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4分布式文件服务提供商"}},[a._v("#")]),a._v(" 1.4分布式文件服务提供商")]),a._v(" "),t("p",[a._v("1）  阿里的OSS")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image026.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("2）  七牛云存储")]),a._v(" "),t("p",[a._v("3）  百度云存储")]),a._v(" "),t("h3",{attrs:{id:"_2-1-fastdsf介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-fastdsf介绍"}},[a._v("#")]),a._v(" 2.1 fastDSF介绍")]),a._v(" "),t("p",[a._v("FastDFS是用c语言编写的一款开源的分布式文件系统，它是由淘宝资深架构师余庆编写并开源。FastDFS专为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。")]),a._v(" "),t("p",[a._v("为什么要使用fastDFS呢？")]),a._v(" "),t("p",[a._v("上边介绍的NFS、GFS都是通用的分布式文件系统，通用的分布式文件系统的优点的是开发体验好，但是系统复杂性高、性能一般，而专用的分布式文件系统虽然开发体验性差，但是系统复杂性低并且性能高。fastDFS非常适合存储图片等那些小文件，fastDFS不对文件进行分块，所以它就没有分块合并的开销，fastDFS网络通信采用 socket，通信速度很快。")]),a._v(" "),t("h3",{attrs:{id:"_2-2-fastdsf工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-fastdsf工作原理"}},[a._v("#")]),a._v(" 2.2 fastDSF工作原理")]),a._v(" "),t("h4",{attrs:{id:"_2-2-1-fastdsf架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-fastdsf架构"}},[a._v("#")]),a._v(" 2.2.1 fastDSF架构")]),a._v(" "),t("p",[a._v("FastDFS架构包括 Tracker server和Storageserver。客户端请求Tracker server进行文件上传、下载，通过Tracker server调度最终由Storage server完成文件上传和下载。")]),a._v(" "),t("p",[a._v("如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image027.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1）  Tracker")]),a._v(" "),t("p",[a._v("Tracker Server作用是负载均衡和调度，通过Tracker server在文件上传时可以根据一些策略找到Storage server提供文件上传服务。可以将tracker称为追踪服务器或调度服务器。")]),a._v(" "),t("p",[a._v("FastDFS集群中的Tracker server可以有多台，Tracker server之间是相互平等关系同时提供服务，Tracker server 不存在单点故障。客户端请求Tracker server采用轮询方式，如果请求的tracker无法提供服务则换另一个tracker。")]),a._v(" "),t("p",[a._v("2）  Storage")]),a._v(" "),t("p",[a._v("Storage Server作用是文件存储，客户端上传的文件最终存储在Storage服务器上，Storage server没有实现自己的文件系统而是使用操作系统的文件系统来管理文件。可以将storage称为存储服务器。")]),a._v(" "),t("p",[a._v("Storage集群采用了分组存储方式。storage集群由一个或多个组构成，集群存储总容量为集群中所有组的存储容量之和。一个组由一台或多台存储服务器组成，组内的Storage server之间是平等关系，不同组的Storage server之")]),a._v(" "),t("p",[a._v("间不会相互通信，同组内的Storage server之间会相互连接进行文件同步，从而保证同组内每个storage上的文件完全一致的。一个组的存储容量为该组内存储服务器容量最小的那个，由此可见组内存储服务器的软硬件配置最好是一致的。")]),a._v(" "),t("p",[a._v("采用分组存储方式的好处是灵活、可控性较强。比如上传文件时，可以由客户端直接指定上传到的组也可以由 tracker进行调度选择。一个分组的存储服务器访问压力较大时，可以在该组增加存储服务器来扩充服务能力（纵向扩容）。当系统容量不足时，可以增加组来扩充存储容量（横向扩容）。")]),a._v(" "),t("p",[a._v("3）  Storage状态收集")]),a._v(" "),t("p",[a._v("Storage server会连接集群中所有的Tracker server，定时向他们报告自己的状态，包括磁盘剩余空间、文件同步状况、文件上传下载次数等统计信息。")]),a._v(" "),t("p",[a._v("2.2.2文件上传流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image029.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("客户端上传文件后存储服务器将文件ID返回给客户端，此文件ID用于以后访问该文件的索引信息。文件索引信息包括：组名，虚拟磁盘路径，数据两级目录，文件名。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image031.gif",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image032.gif",alt:"img"}}),a._v("   虚拟磁盘路径：storage配置的虚拟路径，与磁盘选项store_path*对应。如果配置了store_path0则是M00，如果配置了store_path1则是M01，以此类推。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image033.gif",alt:"img"}}),a._v("数据两级目录：storage服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据文件。")]),a._v(" "),t("p",[a._v("文件名：与文件上传时不同。是由存储服务器根据特定信息生成，文件名包含：源存储服务器IP地址、文件创建时间戳、文件大小、随机数和文件拓展名等信息。")]),a._v(" "),t("h5",{attrs:{id:"_2-2-3-文件下载流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-文件下载流程"}},[a._v("#")]),a._v(" 2.2.3 文件下载流程")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image035.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("tracker根据请求的文件路径即文件ID 来快速定义文件。")]),a._v(" "),t("p",[a._v("比如请求下边的文件：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image036.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1.通过组名tracker能够很快的定位到客户端需要访问的存储服务器组是group1，并选择合适的存储服务器提供客户端访问。")]),a._v(" "),t("p",[a._v("2.存储服务器根据“文件存储虚拟磁盘路径”和“数据文件两级目录”可以很快定位到文件所在目录，并根据文件名找到客户端需要访问的文件。")]),a._v(" "),t("h2",{attrs:{id:"_1-fastdfs入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-fastdfs入门"}},[a._v("#")]),a._v(" ["),t("a",{attrs:{href:"#_ftn1"}},[a._v("1]")]),a._v(" fastDFS入门")]),a._v(" "),t("h3",{attrs:{id:"_3-1-1fastdfs安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1fastdfs安装"}},[a._v("#")]),a._v(" 3.1.1fastDFS安装")]),a._v(" "),t("p",[a._v("tracker和storage使用相同的安装包，fastDFS的下载地址在：https://github.com/happyfish100/FastDFS 本教程下载：FastDFS_v5.05.tar.gz")]),a._v(" "),t("p",[a._v("FastDFS是C语言开发，建议在linux上运行，本教程使用CentOS7作为安装环境。")]),a._v(" "),t("p",[a._v("安装细节请参考 “fastDFS安装教程.doc”。")]),a._v(" "),t("h3",{attrs:{id:"_3-1-2tracker配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2tracker配置"}},[a._v("#")]),a._v(" 3.1.2Tracker配置")]),a._v(" "),t("p",[a._v("fastDFS的配置文件目录 ：/etc/fdfs")]),a._v(" "),t("p",[a._v("主要的配置文件：/etc/fdfs/tracker.conf （tracker配置文件 ）；storage.conf（storage配置文件）")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image037.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("tracker.conf配置内容如下：端口：port=22122 tracker 基础目录：base_path=/home/fastdfs，tracker在运行时会向此目录存储storage的管理数据。")]),a._v(" "),t("h3",{attrs:{id:"_3-1-3storage配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3storage配置"}},[a._v("#")]),a._v(" 3.1.3storage配置")]),a._v(" "),t("p",[a._v("storage.conf配置 内容如下：组名：group_name=group1 端口：port=23000")]),a._v(" "),t("p",[a._v("向tracker心跳间隔（秒）：heart_beat_interval=30 storage基础目录：base_path=/home/fastdfs")]),a._v(" "),t("p",[a._v("磁盘存储目录：")]),a._v(" "),t("p",[a._v("store_path0=/home/fastdfs/fdfs_storage 此目录下存储上传的文件，在/home/fastdfs/fdfs_storage/data下 store_path1=...")]),a._v(" "),t("p",[a._v("...")]),a._v(" "),t("p",[a._v("有多个磁盘就定义多个store_path")]),a._v(" "),t("p",[a._v("上报tracker的地址：tracker_server=192.168.101.64:22122 如果有多个tracker则配置多个tracker，比如：")]),a._v(" "),t("p",[a._v("tracker_server=192.168.101.64:22122 tracker_server=192.168.101.65:22122")]),a._v(" "),t("p",[a._v("....")]),a._v(" "),t("h3",{attrs:{id:"_3-1-4启动停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4启动停止"}},[a._v("#")]),a._v(" 3.1.4启动停止")]),a._v(" "),t("p",[a._v("fastDFS启动/停止脚本目录：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image038.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("fdfs_trackerd：tracker脚本，通过此脚本对 tracker进行启动和停止")]),a._v(" "),t("p",[a._v("/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart")]),a._v(" "),t("p",[a._v("fdfs_storaged：storage脚本，通过此脚本对 storage进行启动和停止")]),a._v(" "),t("p",[a._v("/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart")]),a._v(" "),t("h3",{attrs:{id:"_3-2-文件上传下载测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-文件上传下载测试"}},[a._v("#")]),a._v(" 3.2 文件上传下载测试")]),a._v(" "),t("h4",{attrs:{id:"_3-2-1搭建环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1搭建环境"}},[a._v("#")]),a._v(" 3.2.1搭建环境")]),a._v(" "),t("p",[a._v("这里我们使用javaApi测试文件的上传。")]),a._v(" "),t("p",[a._v("java版本的fastdfs-client地址在：https://github.com/happyfish100/fastdfs-client-java，参考此工程编写测试用例。")]),a._v(" "),t("p",[a._v("1）  创建maven工程")]),a._v(" "),t("p",[a._v("2）  添加依赖")]),a._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[a._v("配置 文件")])]),a._v(" "),t("p",[a._v("在classpath:config下创建fastdfs-client.properties文件")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image040.gif",alt:"img"}})]),a._v(" "),t("h5",{attrs:{id:"_3-2-2-文件上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-文件上传"}},[a._v("#")]),a._v(" 3.2.2 文件上传")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image041.gif",alt:"img"}})]),a._v(" "),t("h5",{attrs:{id:"_3-2-3-文件查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-文件查询"}},[a._v("#")]),a._v(" 3.2.3 文件查询")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image042.gif",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image043.gif",alt:"img"}})]),a._v(" "),t("h5",{attrs:{id:"_3-2-4-文件下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-文件下载"}},[a._v("#")]),a._v(" 3.2.4 文件下载")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image044.gif",alt:"img"}})]),a._v(" "),t("h3",{attrs:{id:"_4-文件服务案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-文件服务案例"}},[a._v("#")]),a._v(" 4 文件服务案例")]),a._v(" "),t("h4",{attrs:{id:"_4-2需求分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2需求分析"}},[a._v("#")]),a._v(" 4.2需求分析")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image046.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("说明如下：")]),a._v(" "),t("p",[a._v("1、管理员在管理系统中上传图片到fastDFS文件系统。")]),a._v(" "),t("p",[a._v("1）  管理员进入管理系统，点击上传图片，选择本地图片")]),a._v(" "),t("p",[a._v("2）  选择本地图片后，进行上传，前端浏览器会通过http调用文件管理服务的文件上传接口进行上传")]),a._v(" "),t("p",[a._v("3）  文件管理服务通过socket请求fastDFS文件系统的上传图片，最终图片保存在fastDFS文件系统中的storage server中。")]),a._v(" "),t("p",[a._v("2、网友浏览免费视频的课程图片")]),a._v(" "),t("p",[a._v("1）  网友输入www.itcast.cn进入视频下载页面")]),a._v(" "),t("p",[a._v("2）  前端浏览器通过图片地址请求图片服务器代理（nginx）")]),a._v(" "),t("p",[a._v("3）  图片服务器代理根据负载情况将图片浏览请求转发到一台storage server")]),a._v(" "),t("p",[a._v("4）  storage server找到图片后通过nginx将图片响应给网友")]),a._v(" "),t("h5",{attrs:{id:"_4-3-功能开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-功能开发"}},[a._v("#")]),a._v(" 4.3 功能开发")]),a._v(" "),t("h6",{attrs:{id:"_4-3-1-搭建fastdfs文件服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-搭建fastdfs文件服务器"}},[a._v("#")]),a._v(" 4.3.1 搭建fastDFS文件服务器")]),a._v(" "),t("p",[a._v("1）  安装fastDFS tracker和storage 略")]),a._v(" "),t("p",[a._v("2）  在storage server上安装nginx")]),a._v(" "),t("p",[a._v("在storage server上安装nginx的目的是对外通过http访问storage server上的文件。")]),a._v(" "),t("p",[a._v("使用nginx的模块FastDFS-nginx-module，它的作用是通过http方式访问storage中的文件，当storage本机没有要找的文件时向源storage主机代理请求文件。")]),a._v(" "),t("p",[a._v("详细参见 fastDFS安装教程")]),a._v(" "),t("p",[a._v("3）  在安装图片服务代理")]),a._v(" "),t("p",[a._v("图片服务代理的作用是负载均衡，根据storage server的负载情况将图片浏览请求均匀的转发到storage server 上。")]),a._v(" "),t("h6",{attrs:{id:"_4-3-2-搭建文件管理服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-搭建文件管理服务"}},[a._v("#")]),a._v(" 4.3.2 搭建文件管理服务")]),a._v(" "),t("p",[a._v("文件管理服务提供通过http方式上传文件，删除文件、查询文件的功能，管理员通过文件管理服务对文件服务器上的文件进行管理。")]),a._v(" "),t("p",[a._v("文件管理服务采用Spring Boot开发，文件管理服务通过与fastDFS交互最终将用户上传的文件存储到fastDFS上。")]),a._v(" "),t("p",[a._v("在fastDFS入门程序上继续开发：")]),a._v(" "),t("p",[a._v("1）  创建模型")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image047.gif",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框: }"}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image050.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("2）  创建controller")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image051.gif",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框: }"}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image052.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("3)创建application.yml")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image053.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("4）创建spring boot启动类")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image048.gif",alt:"文本框: }"}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image049.gif",alt:"文本框:  "}}),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image054.gif",alt:"img"}})]),a._v(" "),t("h6",{attrs:{id:"_4-3-3-管理系统前端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-管理系统前端"}},[a._v("#")]),a._v(" 4.3.3 管理系统前端")]),a._v(" "),t("p",[a._v("管理员通过管理系统前端上传文件、查询文件、删除文件等操作。")]),a._v(" "),t("p",[a._v("管理系统前端与文件管理服务器通过http交互，这当前流行的前后端分离的架构。")]),a._v(" "),t("p",[a._v("管理系统前端采用当前浏览器的vue.js前端框架实现。")]),a._v(" "),t("p",[a._v("1、  创建前端工程")]),a._v(" "),t("p",[a._v("使用webstorm创建前端工程")]),a._v(" "),t("p",[a._v("工程需要导入vue.js及element-ui")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image055.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("2、  创建upload.html")]),a._v(" "),t("p",[a._v("该文件实现文件上传及预览")]),a._v(" "),t("p",[a._v("1）导入js及 css")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image056.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("2)创建vue实例")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image057.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("3）  添加element-ui的文件上传组件")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image058.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("定义数据对象及方法 ：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image059.gif",alt:"img"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image060.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("4）  配置 nginx虚拟目录")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image061.gif",alt:"img"}})]),a._v(" "),t("p",[a._v("5）  测试")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/FastDFSclip_image063.jpg",alt:"img"}})]),a._v(" "),t("h6",{attrs:{id:"_4-3-4-课程图片浏览"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-课程图片浏览"}},[a._v("#")]),a._v(" 4.3.4 课程图片浏览")]),a._v(" "),t("p",[a._v("网友（学习者）输入www.itcast.cn网址进入免费视频下载页面，浏览器根据页面上的图片地址请求图片服务代理，由代理将请求转发到fastDFS storage server上，最终在浏览器看到图片。")]),a._v(" "),t("p",[a._v("上章节实现图片上传后已经实现图片的预览，本功能实现略。")]),a._v(" "),t("h1",{attrs:{id:"_1-fastdfs安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-fastdfs安装"}},[a._v("#")]),a._v(" 1   FastDFS安装")]),a._v(" "),t("h2",{attrs:{id:"_1-1-安装vmware虚拟机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装vmware虚拟机"}},[a._v("#")]),a._v(" 1.1  安装VMware虚拟机")]),a._v(" "),t("p",[a._v("安装CentOS7虚拟机。")]),a._v(" "),t("h2",{attrs:{id:"_1-2-fastdfs-tracker安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-fastdfs-tracker安装"}},[a._v("#")]),a._v(" 1.2  FastDFS--tracker安装")]),a._v(" "),t("p",[a._v("分别在192.168.101.3和192.168.101.4上安装tracker。")]),a._v(" "),t("p",[a._v("注：初次安装可只安装一台tracker方便调试。")]),a._v(" "),t("h3",{attrs:{id:"_1-2-1-下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-下载"}},[a._v("#")]),a._v(" 1.2.1 下载")]),a._v(" "),t("p",[a._v("tracker和storage使用相同的安装包，下载地址：https://github.com/happyfish100/FastDFS")]),a._v(" "),t("p",[a._v("本教程下载：FastDFS_v5.05.tar.gz")]),a._v(" "),t("h3",{attrs:{id:"_1-2-2-fastdfs安装环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-fastdfs安装环境"}},[a._v("#")]),a._v(" 1.2.2 FastDFS安装环境")]),a._v(" "),t("p",[a._v("FastDFS是C语言开发，建议在linux上运行，本教程使用Centos6.5作为安装环境。")]),a._v(" "),t("p",[a._v("安装FastDFS需要先将官网下载的源码进行编译，编译依赖gcc环境，如果没有gcc环境，需要安装gcc：yum install gcc-c++")]),a._v(" "),t("h3",{attrs:{id:"_1-2-3-安装libevent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-安装libevent"}},[a._v("#")]),a._v(" 1.2.3 安装libevent")]),a._v(" "),t("p",[a._v("FastDFS依赖libevent库，需要安装：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("yum -y install libevent\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("1.2.4 安装libfastcommon")]),a._v(" "),t("p",[a._v("​    libfastcommon是FastDFS官方提供的，libfastcommon包含了FastDFS运行所需要的一些基础库。")]),a._v(" "),t("p",[a._v("​    将libfastcommonV1.0.7.tar.gz拷贝至/usr/local/下")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cd /usr/local\ntar -zxvf libfastcommonV1.0.7.tar.gz\ncd libfastcommon-1.0.7\n./make.sh\n./make.sh install\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[t("strong",[a._v("注意：libfastcommon安装好后会自动将库文件拷贝至/usr/lib64下，由于FastDFS程序引用usr/lib目录所以需要将/usr/lib64下的库文件拷贝至/usr/lib下。")])]),a._v(" "),t("p",[t("strong",[a._v("要拷贝的文件如下：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image001.png",alt:"img"}})]),a._v(" "),t("h3",{attrs:{id:"_1-2-5-tracker编译安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-tracker编译安装"}},[a._v("#")]),a._v(" 1.2.5 tracker编译安装")]),a._v(" "),t("p",[a._v("将FastDFS_v5.05.tar.gz拷贝至/usr/local/下")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("tar -zxvf FastDFS_v5.05.tar.gz\n cd FastDFS\n ./make.sh\n./make.sh install\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("安装成功将安装目录下的conf下的文件拷贝到/etc/fdfs/下。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image003.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("1.2.6 配置")]),a._v(" "),t("p",[a._v("安装成功后进入/etc/fdfs目录：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image004.png",alt:"img"}})]),a._v(" "),t("p",[a._v("拷贝一份新的tracker配置文件：")]),a._v(" "),t("p",[a._v("cp tracker.conf.sample tracker.conf")]),a._v(" "),t("p",[a._v("修改tracker.conf")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi tracker.conf\nbase_path=/home/yuqing/FastDFS  \n改为：\nbase_path=/home/FastDFS\n配置http端口：\nhttp.server_port=80\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("h3",{attrs:{id:"_1-2-7-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-7-启动"}},[a._v("#")]),a._v(" 1.2.7 启动")]),a._v(" "),t("p",[a._v("/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart")]),a._v(" "),t("p",[a._v("启动的日志显示先停止5619进程（实际环境不是5619）再启动，如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image005.png",alt:"img"}})]),a._v(" "),t("p",[a._v("注意：如果没有显示上图要注意是否正常停止原有进程。")]),a._v(" "),t("h2",{attrs:{id:"_1-3-fastdfs-storage安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-fastdfs-storage安装"}},[a._v("#")]),a._v(" 1.3  FastDFS--storage安装")]),a._v(" "),t("p",[a._v("分别在192.168.101.5、192.168.101.6、192.168.101.7、192.168.101.8上安装storage。")]),a._v(" "),t("p",[a._v("注：初次安装可只安装一台storage方便调试。")]),a._v(" "),t("h3",{attrs:{id:"_1-3-1-安装libevent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-安装libevent"}},[a._v("#")]),a._v(" 1.3.1 安装libevent")]),a._v(" "),t("p",[a._v("同tracker安装")]),a._v(" "),t("h3",{attrs:{id:"_1-3-2-安装libfastcommon"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-安装libfastcommon"}},[a._v("#")]),a._v(" 1.3.2 安装libfastcommon")]),a._v(" "),t("p",[a._v("同tracker安装。")]),a._v(" "),t("h3",{attrs:{id:"_1-3-3-storage编译安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-storage编译安装"}},[a._v("#")]),a._v(" 1.3.3 storage编译安装")]),a._v(" "),t("p",[a._v("同tracker编译安装。")]),a._v(" "),t("h3",{attrs:{id:"_1-3-4-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-4-配置"}},[a._v("#")]),a._v(" 1.3.4 配置")]),a._v(" "),t("p",[a._v("安装成功后进入/etc/fdfs目录：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image004.png",alt:"img"}})]),a._v(" "),t("p",[a._v("拷贝一份新的storage配置文件：")]),a._v(" "),t("p",[a._v("cp storage.conf.sample storage.conf")]),a._v(" "),t("p",[a._v("修改storage.conf")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi storage.conf\n\ngroup_name=group1\n\nbase_path=/home/yuqing/FastDFS改为：base_path=/home/FastDFS\n\nstore_path0=/home/yuqing/FastDFS改为：store_path0=/home/FastDFS/fdfs_storage\n\n\\#如果有多个挂载磁盘则定义多个store_path，如下\n\n\\#store_path1=.....\n\n\\#store_path2=......\n tracker_server=192.168.101.3:22122  #配置tracker服务器:IP\n\n\\#如果有多个则配置多个tracker\n\ntracker_server=192.168.101.4:22122\n\n\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br")])]),t("p",[a._v("#配置http端口")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http.server_port=80\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"_1-3-5-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-5-启动"}},[a._v("#")]),a._v(" 1.3.5 启动")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("启动的日志显示先停止8931进程（实际环境不是8931）再启动，如下图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image006.png",alt:"img"}})]),a._v(" "),t("p",[a._v("注意：如果没有显示上图要注意是否正常停止原有进程。")]),a._v(" "),t("h2",{attrs:{id:"_1-4-上传图片测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-上传图片测试"}},[a._v("#")]),a._v(" 1.4  上传图片测试")]),a._v(" "),t("h3",{attrs:{id:"_1-4-1-通过fdfs-test程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-通过fdfs-test程序"}},[a._v("#")]),a._v(" 1.4.1 通过fdfs_test程序")]),a._v(" "),t("p",[a._v("FastDFS安装成功可通过/usr/bin/fdfs_test测试上传、下载等操作。")]),a._v(" "),t("p",[a._v("修改/etc/fdfs/client.conf")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("tracker_server根据自己部署虚拟机的情况配置 。\n\nbase_path=/home/fastdfs\n\ntracker_server=192.168.101.3:22122\n\ntracker_server=192.168.101.4:22122\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("使用格式：")]),a._v(" "),t("p",[a._v("/usr/bin/fdfs_test 客户端配置文件地址 upload 上传文件")]),a._v(" "),t("p",[a._v("比如将/home下的图片上传到FastDFS中：")]),a._v(" "),t("p",[a._v("/usr/bin/fdfs_test /etc/fdfs/client.conf upload /home/tomcat.png")]),a._v(" "),t("p",[a._v("打如下日志：")]),a._v(" "),t("p",[a._v("This is FastDFS client test program v5.05")]),a._v(" "),t("p",[a._v("Copyright (C) 2008, Happy Fish / YuQing")]),a._v(" "),t("p",[a._v("FastDFS may be copied only under the terms of the GNU General")]),a._v(" "),t("p",[a._v("Public License V3, which may be found in the FastDFS source kit.")]),a._v(" "),t("p",[a._v("Please visit the FastDFS Home Page http://www.csource.org/")]),a._v(" "),t("p",[a._v("for more detail.")]),a._v(" "),t("p",[a._v("[2015-05-18 02:07:10] DEBUG - base_path=/home/FastDFS, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0")]),a._v(" "),t("p",[a._v("tracker_query_storage_store_list_without_group:")]),a._v(" "),t("p",[a._v("​    server 1. group_name=, ip_addr=192.168.101.5, port=23000")]),a._v(" "),t("p",[a._v("​    server 2. group_name=, ip_addr=192.168.101.6, port=23000")]),a._v(" "),t("p",[a._v("group_name=group1, ip_addr=192.168.101.5, port=23000")]),a._v(" "),t("p",[a._v("storage_upload_by_filename")]),a._v(" "),t("p",[a._v("group_name=group1, remote_filename=M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485.png")]),a._v(" "),t("p",[a._v("source ip address: 192.168.101.5")]),a._v(" "),t("p",[a._v("file timestamp=2015-05-18 02:07:11")]),a._v(" "),t("p",[a._v("file size=5103")]),a._v(" "),t("p",[a._v("file crc32=3979441827")]),a._v(" "),t("p",[a._v("example file url: http://192.168.101.5/group1/M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485.png")]),a._v(" "),t("p",[a._v("storage_upload_slave_by_filename")]),a._v(" "),t("p",[a._v("group_name=group1, remote_filename=M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png")]),a._v(" "),t("p",[a._v("source ip address: 192.168.101.5")]),a._v(" "),t("p",[a._v("file timestamp=2015-05-18 02:07:11")]),a._v(" "),t("p",[a._v("file size=5103")]),a._v(" "),t("p",[a._v("file crc32=3979441827")]),a._v(" "),t("p",[a._v("example file url: http://192.168.101.5/group1/M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png")]),a._v(" "),t("p",[a._v("http://192.168.101.5/group1/M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png就是文件的下载路径。")]),a._v(" "),t("p",[a._v("对应storage服务器上的")]),a._v(" "),t("p",[a._v("/home/fastdfs/fdfs_storage/data/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png文件。")]),a._v(" "),t("p",[a._v("由于现在还没有和nginx整合无法使用http下载。")]),a._v(" "),t("h2",{attrs:{id:"_1-5-fastdfs-和nginx整合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-fastdfs-和nginx整合"}},[a._v("#")]),a._v(" 1.5  FastDFS 和nginx整合")]),a._v(" "),t("h3",{attrs:{id:"_1-5-1-nginx代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-nginx代理"}},[a._v("#")]),a._v(" 1.5.1 nginx代理")]),a._v(" "),t("p",[a._v("nginx代理storage上的nginx，并进行负载均衡。")]),a._v(" "),t("p",[a._v("nginx的安装细节参考nginx文档，这里使用单机nginx，也可以使用两台nginx组成高可用或者采用lvs+nginx访问Storage上的nginx。")]),a._v(" "),t("p",[a._v("创建nginx-fdfs.conf配置文件：")]),a._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#storage群group1组")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("upstream")]),a._v(" storage_server_group1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n​      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")]),a._v(" 192.168.101.5:80 weight=10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")]),a._v(" 192.168.101.6:80 weight=10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  \\#storage群group2组\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("upstream")]),a._v(" storage_server_group2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n​      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")]),a._v(" 192.168.101.7:80 weight=10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")]),a._v(" 192.168.101.8:80 weight=10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n \n  "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n​    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("listen")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("server_name")]),a._v(" ccc.test.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​    \n​    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("location")]),a._v(" /group1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_redirect")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_pass")]),a._v(" http://storage_server_group1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("location")]),a._v(" /group2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_redirect")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_set_header")]),a._v(" X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​       "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("proxy_pass")]),a._v(" http://storage_server_group2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n​    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br")])]),t("h3",{attrs:{id:"_1-5-2-在storage上安装nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-在storage上安装nginx"}},[a._v("#")]),a._v(" 1.5.2 在Storage上安装nginx")]),a._v(" "),t("h4",{attrs:{id:"_1-5-2-1-fastdfs-nginx-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-1-fastdfs-nginx-module"}},[a._v("#")]),a._v(" 1.5.2.1 FastDFS-nginx-module")]),a._v(" "),t("p",[a._v("将FastDFS-nginx-module_v1.16.tar.gz传至/usr/local/下")]),a._v(" "),t("p",[a._v("cd /usr/local")]),a._v(" "),t("p",[a._v("tar -zxvf FastDFS-nginx-module_v1.16.tar.gz")]),a._v(" "),t("p",[a._v("cd FastDFS-nginx-module/src")]),a._v(" "),t("p",[a._v("修改config文件将/usr/local/路径改为/usr/")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/clip_image008.jpg",alt:"img"}})]),a._v(" "),t("p",[a._v("将FastDFS-nginx-module/src下的mod_FastDFS.conf拷贝至/etc/fdfs/下")]),a._v(" "),t("p",[a._v("cp mod_FastDFS.conf /etc/fdfs/")]),a._v(" "),t("p",[a._v("并修改mod_FastDFS.conf的内容：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi /etc/fdfs/mod_FastDFS.conf\n\nbase_path=/home/FastDFS\n\ntracker_server=192.168.101.3:22122\n\ntracker_server=192.168.101.4:22122\n\nurl_have_group_name=true    #url中包含group名称\n\nstore_path0=/home/FastDFS/fdfs_storage  #指定文件存储路径\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("p",[a._v("#如果有多个")]),a._v(" "),t("p",[a._v("将libfdfsclient.so拷贝至/usr/lib下")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cp /usr/lib64/libfdfsclient.so /usr/lib/\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("创建nginx/client目录")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mkdir -p /var/temp/nginx/client\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h4",{attrs:{id:"_1-5-2-2-nginx安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-2-nginx安装"}},[a._v("#")]),a._v(" 1.5.2.2 nginx安装")]),a._v(" "),t("p",[a._v("添加FastDFS-nginx-module模块")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./configure \\\n\n--prefix=/usr/local/nginx \\\n\n--pid-path=/var/run/nginx/nginx.pid \\\n\n--lock-path=/var/lock/nginx.lock \\\n\n--error-log-path=/var/log/nginx/error.log \\\n\n--http-log-path=/var/log/nginx/access.log \\\n\n--with-http_gzip_static_module \\\n\n--http-client-body-temp-path=/var/temp/nginx/client \\\n\n--http-proxy-temp-path=/var/temp/nginx/proxy \\\n\n--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\\n\n--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\\n\n--http-scgi-temp-path=/var/temp/nginx/scgi \\\n\n--add-module=/usr/local/FastDFS-nginx-module/src\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("make\n\nmake install\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h4",{attrs:{id:"_1-5-2-3-nginx配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-3-nginx配置文件"}},[a._v("#")]),a._v(" 1.5.2.3 nginx配置文件")]),a._v(" "),t("p",[a._v("新建一个nginx配置文件nginx-fdfs.conf.")]),a._v(" "),t("p",[a._v("添加server:")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("server {\n​    listen    80;\n​    server_name 192.168.101.7;\n​    location /group1/M00/{\n​        root /home/FastDFS/fdfs_storage/data;\n​        ngx_FastDFS_module;\n​    }\n\n}\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("说明：")]),a._v(" "),t("p",[a._v("server_name指定本机ip")]),a._v(" "),t("p",[a._v("location /group1/M00/：group1为nginx 服务FastDFS的分组名称，M00是FastDFS自动生成编号，对应store_path0=/home/FastDFS/fdfs_storage，如果FastDFS定义store_path1，这里就是M01")]),a._v(" "),t("h3",{attrs:{id:"_1-5-3-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-3-测试"}},[a._v("#")]),a._v(" 1.5.3 测试")]),a._v(" "),t("p",[a._v("通过java客户端上传文件，使用浏览器http访问文件，这里访问上传图片测试的文件：")]),a._v(" "),t("p",[a._v("访问storage：")]),a._v(" "),t("p",[a._v("http://192.168.101.5/group1/M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png")]),a._v(" "),t("p",[a._v("ip地址改为192.168.101.6也行，因为同一个分组的storage文件互相同步。")]),a._v(" "),t("p",[a._v("访问tracker：")]),a._v(" "),t("p",[a._v("http://192.168.101.3/group1/M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png")]),a._v(" "),t("p",[a._v("ip地址改为192.168.101.4也行。")]),a._v(" "),t("p",[t("strong",[a._v("使用域名访问 (推荐)：")])]),a._v(" "),t("p",[a._v("nginx对外由vip提供服务，使用域名访问如下：")]),a._v(" "),t("p",[a._v("比如vip对应的域名为img.test.com：")]),a._v(" "),t("p",[a._v("http://img.test.com/group1/M00/00/00/wKhlBVVY2M-AM_9DAAAT7-0xdqM485_big.png")])])}),[],!1,null,null,null);s.default=r.exports}}]);
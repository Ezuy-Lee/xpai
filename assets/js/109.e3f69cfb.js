(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{534:function(s,a,t){"use strict";t.r(a);var n=t(15),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"环境说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境说明"}},[s._v("#")]),s._v(" 环境说明")]),s._v(" "),t("p",[s._v("准备两台虚拟机，虚拟机上安装CentOS5.4版本；")]),s._v(" "),t("p",[s._v("A服务器IP：192.168.134.135")]),s._v(" "),t("p",[s._v("B服务器IP：192.168.134.136")]),s._v(" "),t("p",[s._v("A机上安装nginx-1.2.0和apache-tomcat-6.0.33")]),s._v(" "),t("p",[s._v("B机上安装memcached-1.4.10和apache-tomcat-6.0.33")]),s._v(" "),t("p",[s._v("除此之外，我们还需要一些MSM相关的jar包：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("javolution-5.4.3.1.jar\nmemcached-2.4.2.jar\nmemcached-session-manager-1.5.1.jar\nmemcached-session-manager-tc6-1.5.1.jar\nmsm-javolution-serializer-1.5.1.jar\nmsm-kryo-serializer-1.5.1.jar\nmsm-xstream-serializer-1.5.1.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("以上jar包在http://code.google.com/p/memcached-session-manager/downloads/list中下载。")]),s._v(" "),t("h3",{attrs:{id:"配置session共享"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置session共享"}},[s._v("#")]),s._v(" 配置Session共享")]),s._v(" "),t("p",[s._v("将上面所述的MSM的jar包拷贝至Tomcat安装目录lib文件夹中；")]),s._v(" "),t("p",[s._v("编辑context.xml")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('\n<Manager className="de.javakaffee.web.msm.MemcachedBackupSessionManager"\nmemcachedNodes="n1: 192.168.134.136:11211"\nrequestUriIgnorePattern=".*/.(png|gif|jpg|css|js)$"\nsessionBackupAsync="false"\nsessionBackupTimeout="100"\ntranscoderFactoryClass="de.javakaffee.web.msm.serializer.javolution.JavolutionTranscoderFactory"\ncopyCollectionsForSerialization="false"/>\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("重启两个Tomcat。")]),s._v(" "),t("h3",{attrs:{id:"配置nginx负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx负载均衡"}},[s._v("#")]),s._v(" 配置Nginx负载均衡")]),s._v(" "),t("p",[s._v("Nginx安装完毕后，修改配置文件conf/nginx.conf")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" web_server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip_hash;")]),s._v("\n\n   "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.134.135:8080 max_fails=3  fail_timeout=30s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n   "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.134.136:8080 max_fails=3  fail_timeout=30s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ .*\\.jsp$")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n         "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   http://web_server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n         "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("p",[s._v("重启Nginx")]),s._v(" "),t("h3",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),t("p",[s._v("在两个Tomcat的webapps目录下创建test目录，在test目录下，创建test_session.jsp文件，文件内容如下：")]),s._v(" "),t("div",{staticClass:"language-jsp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<%@ page contentType="text/html; charset=GBK" %>\n\n<%@ page import="java.util.*" %>\n\n<html><head><title>Cluster App Test</title></head>\n\n<body>\n\n   Server Info:\n\n   <%\n\nout.println(request.getLocalAddr() + ":" + request.getLocalPort());\n\n%>\n\n<br><br>\n\n    <% \n\nout.println("<br> ID " + session.getId()+"<br>"); \n\nString dataName = request.getParameter("dataName");\n\nif (dataName != null && dataName.length() > 0) { \n\nString dataValue = request.getParameter("dataValue") ;\n\nsession.setAttribute(dataName, dataValue); \n\n} \n\nout.print("<b>Session list</b> <br>"); \n\nEnumeration e = session.getAttributeNames(); \n\nwhile (e.hasMoreElements()) { \n\nString name = (String)e.nextElement();\n\nString value = session.getAttribute(name).toString(); \n\nout.println( name + " = " + value+"<br>");\n\nSystem.out.println( name + " = " + value);\n\n}\n\n%>\n\n            \n\n<form action="test_session.jsp" method="POST">\n\n          name:<input type=text size=20 name="dataName"> <br>\n\n          key:<input type=text size=20 name="dataValue"> <br>\n\n          <input type=submit>\n\n    </form>\n\n  </body>\n\n</html>\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br")])]),t("h4",{attrs:{id:"测试-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),t("p",[s._v("先启动memcached")]),s._v(" "),t("p",[s._v("然后启动niginx和两个Tomcat。")]),s._v(" "),t("p",[s._v("打开浏览器，输入http:// 192.168.134.135/test/test_session.jsp")]),s._v(" "),t("p",[s._v("填写name和key，提交后看以看到")]),s._v(" "),t("p",[s._v("关闭192.168.134.135上的Tomcat，再刷新，如果ID的值相同且Session List中值也存在，说明Session是被共享的。")]),s._v(" "),t("h3",{attrs:{id:"nginx环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx环境"}},[s._v("#")]),s._v(" nginx环境")]),s._v(" "),t("h4",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("下载nginx服务包，在此我使用的是nginx1.3.13")]),s._v(" "),t("p",[s._v("主要配置conf目录下的配置文件和使用nginx.exe的服务。\n在cmd中进入nginx.exe所在的目录，输入：start nginx.exe启动nginx服务；nginx.exe –s quit或nginx.exe –s stop 停止nginx服务；nginx.exe –s reload刷新nginx的配置文件。")]),s._v(" "),t("h4",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("p",[s._v("找到nginx的安装目录：ngin1.3.13/conf/conf文件")]),s._v(" "),t("p",[s._v("nginx.conf文件是nginx的核心配置文件。具体配置见下图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/464291-20160601175628867-1905617628.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/464291-20160601175640305-1731555806.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"msm环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#msm环境"}},[s._v("#")]),s._v(" msm环境")]),s._v(" "),t("h4",{attrs:{id:"安装-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("下载memcached服务及安装包，如图所示：")]),s._v(" "),t("p",[s._v("memcached.exe为memcached服务，也是windows服务的一部分，memcached.exe一定要下载和自己电脑的bit数一致，如：32为、64位；其它则为缓存服务器所依赖的JAR文件，其中")]),s._v(" "),t("p",[s._v("是Tomcat7及以上所需要的JAR，如果使用的是Tomact6的版本则下载对应的版本，如：memcached-session-maager-tc7-1.6.3.jar，其他的JAR文件在该地址中都可以对应的找到：\nhttp://code.google.com/p/memcached-session-manager/downloads/list。")]),s._v(" "),t("p",[s._v("将memcached.exe放到一个目录下面，如D:\\msm\\memcached.exe。在cmd中进入到memcached.exe的目录：memcached.exe –d install安装memcached服务;memcached.exe –p 11211 –d start启动memcached服务，其中11211是该服务的端口号;memcached.exe –d uninstall 卸载memcached服务。")]),s._v(" "),t("h4",{attrs:{id:"配置-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-2"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("p",[s._v("在tomcat的lib目录中加入memcached缓存支持的JAR文件（12个jar）。\n在tomcat目录下的content.xml文件，在content标签中加入：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Manager")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("de.javakaffee.web.msm.MemcachedBackupSessionManager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("memcachedNodes")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("n2:localhost:11211"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("requestUriIgnorePattern")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v(".*/.(png|gif|jpg|css|js)$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sessionBackupAsync")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sessionBackupTimeout")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("100"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("transcoderFactoryClass")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("de.javakaffee.web.msm.serializer.javolution.JavolutionTranscoderFactory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("copyCollectionsForSerialization")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("false"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('memcachedNodes属性中的n2表示服务中的节点，可以自定义的，但是不同的memcached服务规定节点不能一样，否则不能实现session共享，不同的服务定义不同的节点，一个memcachedNodes也可以定义多个节点：memcachedNodes=" n2:localhost:11211 n2:192.168.21.**:11211"，不同的节点直接用空格或逗号隔开即可。')]),s._v(" "),t("p",[s._v("修改tomcat目录下的server.xml文件，在Engine标签中添加jvmRote属性，jvm的值不能和集群中tomcat中的jvmRote值重复。")]),s._v(" "),t("p",[s._v("tomcat通过在不同的jmv上配置不同的jvmRoute参数，来防止集群的时候sessionid冲突：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('<Engine name="Catalina" defaultHost="localhost" jvmRoute="jvm1" />。\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意：jvm值在同一个集群中不能一样，用来标识不同的tomcat服务，在msm集群中的每个tomcat必须要写。")]),s._v(" "),t("h3",{attrs:{id:"tomcat环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tomcat环境"}},[s._v("#")]),s._v(" tomcat环境")]),s._v(" "),t("p",[s._v("每个tomcat的端口不能重复，如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Ezuy-Lee/RainzeDrawingBed/media/464291-20160601175507758-327136926.png",alt:""}})]),s._v(" "),t("p",[s._v("下图是对tomcat中server.xml文件中的端口解释")]),s._v(" "),t("p",[s._v("实现域名访问tomcat中的项目需要把tomcat默认显示的index.jsp进行更改掉")]),s._v(" "),t("p",[s._v("打开index.jsp页面，将里面css部分、body标签部分全部删除，然后在index.jsp内部最后添加：")]),s._v(" "),t("div",{staticClass:"language-jsp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<script>        Window.οnlοad=function(){            Window.loaction=”../dkce/app/index.jsp”;}<\/script>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注意：每个tomcat中的访问端口必须要在防火墙的入站规则里面进行创建，如当前的tomcat的对外端口是8080，则要在入站规则里面创建一个对外的端口。")]),s._v(" "),t("h4",{attrs:{id:"安装配置与启动项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置与启动项"}},[s._v("#")]),s._v(" 安装配置与启动项")]),s._v(" "),t("p",[s._v("1.1               将nginx和memcached服务进行安装，然后启动memcached服务。")]),s._v(" "),t("p",[s._v("1.2               配置JDK、环境变量，将项目放入tomcat中，进行配置memcached和域名访问的方式，上面已经详细介绍，启动tomcat。")]),s._v(" "),t("p",[s._v("1.3               配置nginx脚本(conf.xml)，配置完成之后进行启动。")]),s._v(" "),t("p",[s._v("1.4               A.如果重启nginx服务不需要重启tomcat服务。B.如果重启tomcat服务，需要重启nginx服务（不是关机重启,是使用命令重启，2秒钟即可完成）。")]),s._v(" "),t("p",[s._v("1.5               如果在tomcat集群中移除其中的一台tomcat服务器，对于整个集群是不受影响的。添加一台tomcat服务器只需在nginx中注册该服务并重启nginx服务即可。在整个集群，无论nginx停止或重启、tomcat停止或重启对memcached服务不受任何影响。")])])}),[],!1,null,null,null);a.default=e.exports}}]);